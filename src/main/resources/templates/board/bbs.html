<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <script src="https://code.jquery.com/jquery-latest.min.js"></script>
    <!-- Font Awesome icons (free version)-->
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <!-- Bootstrap icons-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css"
          type="text/css"/>
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=Noto+Sans+KR:wght@100;200;300;400;500;600;700;800;900&display=swap"
          rel="stylesheet">
    <!-- Core theme CSS (includes Bootstrap)-->

    <link href="assets/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="assets/css/style.css?after" rel="stylesheet"/>
    <link href="assets/css/commonstyle.css?after" rel="stylesheet"/>

    <title>Three Go</title>
</head>
<body>

<script>
    $(document).ready(function (){
        activePage()
        selectedSort();
    })

    function activePage(){
        let pageNum = 1;
        const urlParams = new URL(location.href).searchParams;
        let pageTemp = urlParams.get('pageNum');
        if(pageTemp !== null){
            pageNum = pageTemp
        }
        $('#pageBtn' + pageNum).addClass('active');
    }

    function selectedSort(){
        let selected = 'time';
        const urlParams = new URL(location.href).searchParams;
        let sortTemp = urlParams.get('sort');
        if(sortTemp !== null){
            selected = sortTemp
        }
        $('#sort-select option[name=' + selected +']').prop("selected", true);
    }

    function PostToLogin(){
        alert("글 작성은 로그인 후에 가능합니다.");
        location.href =  "/login";
    }

    function resetKeyword(){
        location.href =  "/board";
    }
</script>


<!-- header-->
<th:block th:replace="~{fragments/header}"></th:block>

<div class="sub-header">
    <div class="container pt-5 pl-5">
        <h3 class="display-6 text-white">게시판</h3>
    </div>
</div>

<form method="get" name="writeFrm">
    <div class="container position-relative">
        <div class="d-flex justify-content-center gap-3 pt-5">
            <button type="button" class="btn btn-outline-primary btn-sm" onclick="resetKeyword()">검색 설정 초기화</button>
            <div class="d-flex justify-content-center">
                <select name="searchField">
<!--                    <option value="b_title"<c:if test="${param.searchField ne 'b_content'}"> selected="selected"</c:if>>제목</option>-->
<!--                    <option value="b_content"<c:if test="${param.searchField eq 'b_content'}"> selected="selected"</c:if>>내용</option>-->
                </select>
                <input type="text" name="searchWord" value="${param.searchWord}">
                <input type="submit" value="검색" class="btn btn-primary btn-sm">
            </div>
            <select id="sort-select" onchange="window.open(value,'_self');">
<!--                <c:choose>-->
<!--                    <c:when test="${empty param.searchWord}">-->
                        <option name="time" value="../community/list.do?sort=time">최신순</option>
                        <option name="like" value="../community/list.do?sort=like">추천순</option>
                        <option name="visit" value="../community/list.do?sort=visit">조회순</option>
<!--                    </c:when>-->
<!--                    <c:otherwise>-->
                        <option name="time" value="../community/list.do?sort=time&searchField=${param.searchField}&searchWord=${param.searchWord}">최신순</option>
                        <option name="like" value="../community/list.do?sort=like&searchField=${param.searchField}&searchWord=${param.searchWord}">추천순</option>
                        <option name="visit" value="../community/list.do?sort=visit&searchField=${param.searchField}&searchWord=${param.searchWord}">조회순</option>
<!--                    </c:otherwise>-->
<!--                </c:choose>-->
            </select>
        </div>



        <!--리스트 샘플-->
        <!--    <div class="card-deck row row-cols-1 row-cols-md-3 g-4">--%>
        <%--        <div class="col">--%>
            <%--            <div class="card card-item">--%>
                <%--                <img class="card-img-top" src="#" alt="Card image cap">--%>
                <%--                <div class="card-body">--%>
                    <%--                    <h5 class="card-title">여기에 제목이 들어갑니다.</h5>--%>
                    <%--                    <h5 class="card-title">여기에 제목이 들어갑니다.</h5>--%>
                    <%--                    <p class="card-text">여기에 내용이 들어가는데 내용이 많아지면 ...로 줄입니다. css를 이용해서</p>--%>
                    <%--                </div>--%>
                <%--                <div class="card-footer">--%>
                    <%--                    <small class="text-muted">작성날짜나 작성자이름을 쓰면 되겟군요</small>--%>
                    <%--                    <small class="text-muted">작성날짜나 작성자이름을 쓰면 되겟군요</small>--%>
                    <%--                </div>--%>
                <%--            </div>--%>
            <%--        </div>--%>
        <%--    </div>-->

        <div class="card-deck row row-cols-1 row-cols-md-3 g-4 pt-5 pb-5" >
            <!-- 게시물이 없을 때 -->
            <div class="col" th:if="${board == null} or ${board.size() == 0}">
                <p class="card-text">등록된 게시물이 없습니다.</p>
            </div>


            <a th:each="item : ${board}" th:href="@{/board/{bid}(bid=${item.bid})}">
                <div class="col">
                    <div class="card card-item">
                        <div class="card-img-item">
                            <!--첨부된 이미지가 있을 경우-->
                            <img class="card-img-top" th:if="${item.bofile != null}" src="../../../upload/${dto.b_sfile}" alt="Card image cap">
                            <!--첨부된 이미지가 없을 경우-->
                            <img class="card-img-top" th:if="${item.bofile == null}" src="assets/img/no_image.png" alt="Card image cap">
                        </div>
                        <div class="card-body">
                            <h5 class="card-title" th:text="${item.btitle}"></h5>
                            <p class="card-text" th:text="${item.bcontent}"></p>
                        </div>
                        <div class="card-footer d-flex justify-content-between align-items-center">
                            <div>
                                <small class="text-muted" th:text="${item.username}"></small>
                                <small class="text-muted" th:text="${#temporals.format(item.bpostdate, 'yyyy-MM-dd HH:mm')}"></small>
                            </div>
                            <div class="d-flex gap-2">
                                <small class="text-muted"><i class="bi bi-eye" th:text="${item.bvisitcount}"></i></small>
                                <small class="text-muted"><i class="bi bi-heart"></i></small>
                            </div>
                        </div>
                    </div>
                </div>
            </a>
        </div>

        <div class="container position-relative pb-5">
            <div class="d-flex justify-content-center pb-2">
                ${map.pagingImg}
            </div>

<!--            <c:if test="${not empty sessionScope.u_id}">-->
                <!--로그인이 되어있다면-->
                <div class="d-flex justify-content-end">
                    <button type="button" class="btn btn-primary btn-sm" th:onclick="|location.href='@{/write}'|">글쓰기</button>
                </div>
<!--            </c:if>-->
<!--            <c:if test="${empty sessionScope.u_id}">-->
                <!--로그인이 안되었으면-->
                <div class="d-flex justify-content-end">
                    <button type="button" onclick="PostToLogin();" class="btn btn-primary btn-sm">글쓰기</button>
                </div>
<!--            </c:if>-->
        </div>
    </div>
</form>

<!--footer-->
<th:block th:replace="~{fragments/footer}"></th:block>

<!-- Bootstrap core JS-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="../assets/js/board.js"></script>

</body>
</html>