<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <script src="https://code.jquery.com/jquery-latest.min.js"></script>
    <!-- Font Awesome icons (free version)-->
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <!-- Bootstrap icons-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css"
          type="text/css"/>
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=Noto+Sans+KR:wght@100;200;300;400;500;600;700;800;900&display=swap"
          rel="stylesheet">
    <!-- Core theme CSS (includes Bootstrap)-->

    <link href="assets/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="assets/css/style.css?after" rel="stylesheet"/>
    <link href="assets/css/commonstyle.css?after" rel="stylesheet"/>

    <!--swiper-->
    <link href="assets/swiper/swiper-bundle.min.css" rel="stylesheet" />
    <script src="assets/swiper/swiper-bundle.min.js"></script>
    <title>Three Go</title>

    <style>
        /*#sidebar {
            min-width: 300px;
            max-width: 300px;
            background: #1d1919;
            color: #fff;
            min-height: 100vh;
        }

        #sidebar.active {
            margin-left: -300px
        }

        #sidebar .logo {
            display: block;
            width: 120px;
            height: 120px;
            margin: 0 auto
        }

        #sidebar .logo span {
            display: block
        }

        #sidebar ul.components {
            padding: 0
        }

        #sidebar ul li {
            font-size: 16px
        }

        #sidebar ul li>ul {
            margin-left: 10px
        }

        #sidebar ul li>ul li {
            font-size: 14px
        }

        #sidebar ul li a {
            padding: 10px 0;
            display: block;
            color: rgba(255,255,255,.8);
            border-bottom: 1px solid rgba(255,255,255,.1)
        }

        #sidebar ul li a:hover {
            color: #f8b739
        }

        #sidebar ul li.active>a {
            background: 0 0;
            color: #f8b739
        }

        @media(max-width: 991.98px) {
            #sidebar {
                margin-left:-300px
            }

            #sidebar.active {
                margin-left: 0
            }
        }

        .footer p {
            color: rgba(255,255,255,.5)
        }

        strong.number {
            font-size: 1.3rem;
        }

        .column {
            flex-basis: 0;
            flex-grow: 1;
            max-width: 100%;
            padding-left: 10px;
            padding-right: 10px;
        }

        ul>li>a i.bi {
            margin-left: 1.5rem;
            margin-right: 2rem;
        }
        .number-label {
            display: block;
        }*/


        /*card*/
        .card {
            width: 478px;
        }
        .card .card-header img {
            width: 24px;
            height: 24px;
        }
        .card .card-body img {
            height: 585px;
        }
        .card-header {
            background-color: transparent;
        }


        /*  리뷰작성 관련  */
        #new-post-btn {
            bottom: 5%;
            right: 5%;
        }

        .container-fluid {
            height: 100%;
        }

        .container-fluid .row {
            height: 100%;
        }

        .preview-container {
            position: relative;
            padding: 0 !important;
            height: 100%;
        }

        .delete-img-btn {
            position: absolute;
            top: 5%;
            right: 5%;
        }
        .add-file {
            position: absolute;
            bottom: 5%;
            right: 5%;
            z-index: 100;
        }
        #img-uploader {
            display: none;
        }
        .uploader {
            padding: 10px;
            color: #136DF8;
            cursor: pointer;
        }
        .uploader:hover {
            background-color: #136DF8;
            color: #FFFFFF;
            transition: all 0.2s;
        }
        .select-hint{
            display: none;
        }
        #review-contents {
            height: 380px;
            resize: none;
        }

        /* swiper */
        .swiper {
            width: 100%;
            height: 750px;
            overflow: hidden;
        }

        .swiper-slide {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            font-size: 18px;
            color: #999999;
            background: #333333;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .swiper-slide img {
            display: block;
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
    </style>

</head>
<body>

<div class="d-flex flex-nowrap">
    <th:block th:replace="~{fragments/sidebar}"></th:block>
<!--    <nav id="sidebar" class="">-->
<!--        <div class="pt-5">-->
<!--            &lt;!&ndash;유저 프로필 사진을 누르면 마이페이지로 이동&ndash;&gt;-->
<!--            <a href="#" class="mb-5">-->
<!--                <img src="https://webimage.10x10.co.kr/image/basic600/326/B003260178-1.jpg" class="logo rounded-circle">-->
<!--            </a>-->

<!--            <div class="text-center p-5">-->
<!--                <span class="fs-5 fw-semibold">농담곰</span>-->
<!--            </div>-->

<!--            <div class="counter d-flex justify-content-center text-center pb-5">-->
<!--                <div class="col column">-->
<!--                    <strong class="number">892</strong>-->
<!--                    <span class="number-label">게시글</span>-->
<!--                </div>-->
<!--                <div class="col column">-->
<!--                    <strong class="number">22.5k</strong>-->
<!--                    <span class="number-label">팔로워</span>-->
<!--                </div>-->
<!--                <div class="col column">-->
<!--                    <strong class="number">150</strong>-->
<!--                    <span class="number-label">팔로잉</span>-->
<!--                </div>-->
<!--            </div>-->

<!--            <ul class="list-unstyled components mb-5">-->
<!--                <li class="active">-->
<!--                    <a href="#">-->
<!--                        <i class="bi bi-house-door-fill icon"></i>-->
<!--                        피드-->
<!--                    </a>-->
<!--                </li>-->
<!--                <li>-->
<!--                    <a href="#">-->
<!--                        <i class="bi bi-speedometer2 icon"></i>-->
<!--                        여행정보-->
<!--                    </a>-->
<!--                </li>-->
<!--                <li>-->
<!--                    <a href="#">-->
<!--                        <i class="bi bi-card-checklist icon"></i>-->
<!--                        여행일정-->
<!--                    </a>-->
<!--                </li>-->
<!--                <li>-->
<!--                    <a href="#">-->
<!--                        <i class="bi bi-columns icon"></i>-->
<!--                        커뮤니티-->
<!--                    </a>-->
<!--                </li>-->
<!--                <li>-->
<!--                    <a href="#">-->
<!--                        <i class="bi bi-people-fill icon"></i>-->
<!--                        마이페이지-->
<!--                    </a>-->
<!--                </li>-->
<!--                <li>-->
<!--                    <a href="#">-->
<!--                        <i class="bi bi-people-fill icon"></i>-->
<!--                        로그아웃-->
<!--                    </a>-->
<!--                </li>-->
<!--            </ul>-->
<!--            <div class="footer">-->
<!--                <p>-->
<!--                    푸터에쓸내용-->
<!--                </p>-->
<!--            </div>-->
<!--        </div>-->
<!--    </nav>-->

    <div class="container">
        <div id="content" class="p-4 p-md-5">
            <div class="card">
                <!--유저 정보-->
                <div class="d-flex card-header gap-3">
                    <img src="https://webimage.10x10.co.kr/image/basic600/326/B003260178-1.jpg" alt="mdo" class="rounded-circle">
                    <span>nongdamgom</span>
                    <span>농담곰</span>
                </div>
                <div class="card-body">
                    <!--유저가 업로드한 이미지-->
                    <img class="card-img-top" src="https://webimage.10x10.co.kr/image/basic600/326/B003260178-1.jpg" alt="Card image cap">
                    <!--좋아요와 댓글 -->
                    <div class="d-flex gap-3">
                        <i class="bi bi-heart"></i>
                        <i class="bi bi-chat"></i>
                    </div>


                    <p class="card-text">좋아요 몇개</p>
                    <p class="card-text"><small class="text-muted">댓글 더 보기</small></p>
                </div>
            </div>
        </div>
        <div id="select-book" class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="selectBookLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="selectBookLabel">리뷰북 선택</h1>
                    </div>
                    <div class="modal-body">
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="radio" name="selectReviewBook" id="selectReviewBook1" value="1">
                            <label class="form-check-label" for="selectReviewBook1">
                                새 리뷰북 생성
                                <select id="new-book-item-select" class="book-input form-select form-select-sm mt-2" aria-label="Default select example" onchange="writeBookTitle()">
                                    <option value="hint" class="select-hint" selected>리뷰북에 기록할 여행정보를 선택하세요.</option>
                                    <option value="1">One</option>
                                    <option value="2">Two</option>
                                    <option value="3">Three</option>
                                </select>
                                <input id="new-book-title" class="book-input form-control form-control-sm mt-2" type="text" placeholder="제목을 입력해주세요." aria-label=".form-control-sm example">
                            </label>
                        </div>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="radio" name="selectReviewBook" id="selectReviewBook2" value="2">
                            <label class="form-check-label" for="selectReviewBook2">
                                기존 리뷰북에 추가
                                <select id="exist-book-select" class="book-input form-select form-select-sm mt-2" aria-label="Default select example">
                                    <option value="hint" class="select-hint" selected>리뷰를 작성할 리뷰북을 선택하세요.</option>
                                    <option value="1">아침먹기</option>
                                    <option value="2">점심먹기</option>
                                    <option value="3">저녁먹기</option>
                                </select>
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="selectReviewBook" id="selectReviewBook3" value="3">
                            <label class="book-input form-check-label" for="selectReviewBook3">
                                리뷰북을 선택하지 않고 리뷰 작성
                            </label>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-sm btn-secondary" data-bs-dismiss="modal">닫기</button>
                        <button type="button" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#editor" onclick="goEdit()">다음</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="editor" class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="editorLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-xl">
                <div class="modal-content">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="preview-container col-md-7">
                                <div class="add-file">
                                    <label for="img-uploader" class="uploader border border-primary rounded-pill">사진 추가</label>
                                    <input type="file" id="img-uploader" accept="image/*" onchange="setPreview()" multiple/>
                                </div>
                                <div class="swiper mySwiper">
                                    <div class="swiper-wrapper">
                                        <div class="swiper-slide">사진을 추가해주세요.</div>
                                    </div>
                                    <div class="swiper-controller">
                                        <div class="swiper-button-next"></div>
                                        <div class="swiper-button-prev"></div>
                                        <div class="swiper-pagination"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-5 d-flex align-items-center">
                                <div class="modal-body">
                                    <div class="mb-2">
                                        <label for="selected-review-book" class="form-label">리뷰북</label>
                                        <input type="text" class="form-control form-control-sm" id="selected-review-book" readonly>
                                    </div>
                                    <div class="mb-2">
                                        <label for="select-touritem-info" class="form-label">관광지 정보 불러오기</label>
                                        <select class="form-select form-select-sm" id="select-touritem-info" onchange="selectTouritem()">
                                            <option class="select-hint" disabled selected>관광지 정보를 선택해주세요.</option>
                                            <option value="direct">직접 입력</option>
                                            <option value="contentid1">집가기</option>
                                            <option value="contentid2">밥먹기</option>
                                        </select>
                                    </div>
                                    <div class="mb-2">
                                        <label for="selected-touritem-name" class="form-label">관광지 이름 작성</label>
                                        <input type="text" class="form-control form-control-sm" id="selected-touritem-name" disabled>
                                    </div>
                                    <div class="mb-3">
                                        <label for="review-contents" class="form-label">본문</label>
                                        <textarea class="form-control form-control-sm" id="review-contents"></textarea>
                                    </div>
                                    <div class="editor-btn-group d-flex justify-content-end gap-2">
                                        <button type="button" class="btn btn-sm btn-secondary" data-bs-toggle="modal" data-bs-target="#select-book">이전</button>
                                        <button type="button" class="btn btn-sm btn-primary" data-bs-dismiss="modal">완료</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <button type="button" id="new-post-btn" class="position-fixed rounded-pill btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#select-book">
            <i class="bi bi-compass"></i>
        </button>
    </div>
</div>



    <!-- Bootstrap core JS-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<!--카드 -->
<script th:inline="javascript">
    // 버튼 누르면 더보기
    $(document).ready(function() {
        // $("#morebtn").click(function() {
        //     $(".invisiblecard").slideToggle(500);
        //     if ($("#morebtn").html() == "더보기") {
        //         $("#morebtn").html("접기");
        //     } else {
        //         $("#morebtn").html("더보기");
        //     }
        // });
        //
        selectBook();
        $('.swiper-controller').hide();
        deleteImg();
    });

    // swiper 설정
    var swiper = new Swiper(".mySwiper", {
        observer: true,
        observeParents: true,
        navigation: {
            nextEl: ".swiper-button-next",
            prevEl: ".swiper-button-prev",
        },
        pagination: {
            el: ".swiper-pagination",
        },
        mousewheel: true,
        keyboard: true,
    });

    let selectedReviewBook;
    const fileInput = document.getElementById('img-uploader');
    const images = [];

    function editorReset() {
        //사진 배열 초기화
        images.length = 0;
        fileInput.files.length = 0;
        $('.swiper-wrapper').html('<div class="swiper-slide">사진을 추가해주세요.</div>');
        // 리뷰북 선택 정보 초기화
        $('input:radio[name=selectReviewBook]').prop('checked', false);
        $('#new-book-item-select').html('<option value="hint" class="select-hint" selected>리뷰북에 기록할 여행정보를 선택하세요.</option>');
        $('#new-book-title').val('');
        $('#exist-book-select').html('<option value="hint" class="select-hint" selected>리뷰를 작성할 리뷰북을 선택하세요.</option>');
        // 에디터 내용 초기화
        selectedReviewBook = "";
        $('.book-input').attr('disabled', true);
        $('#selected-review-book').val('');
        $('#select-touritem-info').html(
            '<option class="select-hint" disabled selected>관광지 정보를 선택해주세요.</option>' +
            '<option value="direct">직접 입력</option>'
        );
        $('#selected-touritem-name').val('');
        $('#review-contents').val('');
    }

    function selectBook() {
        $("input:radio[name=selectReviewBook]").click(function (){
            let select = Number($("input[name=selectReviewBook]:checked").val());
            $(".book-input").attr('disabled', true);
            switch (select){
                case 1:
                    $("#new-book-item-select").attr('disabled',false);
                    if($("#new-book-item-select").val() != "hint"){
                        writeBookTitle()
                    }
                    break;
                case 2:
                    $("#exist-book-select").attr('disabled',false);
                    break;
            }
        })
    }

    function writeBookTitle() {
        $("#new-book-title").attr('disabled',false);
    }

    function goEdit(){
        let select = Number($("input[name=selectReviewBook]:checked").val());
        switch (select){
            case 1:
                selectedReviewBook = $("#new-book-title").val();
                break;
            case 2:
                selectedReviewBook = $("#exist-book-select").text();
                break;
            case 3:
                selectedReviewBook = "선택하지 않음";
                break;
        }

        $('#selected-review-book').val(selectedReviewBook);
    }

    function selectTouritem(){
        let item = $('#select-touritem-info option:selected');
        let title = item.text();
        let contentId = item.val();
        console.log(title);
        console.log(contentId);
        let titleInput = $('#selected-touritem-name');
        titleInput.attr('disabled',false);
        titleInput.val(title)
    }

    $('#select-book').on('show.bs.modal', function (e) {
        editorReset();
        let login = [[${loginUserId}]];
        console.log(login);
        if(login == "anonymousUser"){
            alert("리뷰는 로그인 후 작성할 수 있습니다.")
            e.preventDefault();
        }
    })

    function setPreview(){
        let files = fileInput.files;
        if(files.length + images.length > 4){
            files.length = 0;
            alert("사진은 4장까지 첨부할 수 있습니다.")
        }else {
            if(files.length > 0 && images.length === 0) {
                $('.swiper-wrapper').html("");
            }
            if(files.length > 0){
                for (let file of files) {
                    images.push(file);

                    let reader = new FileReader();

                    reader.onload = function(data) {
                        const tempHtml = `<div class="swiper-slide">` +
                            `<button class="delete-img-btn btn btn-dark rounded-pill opacity-50">` +
                            `<i class="bi bi-x-lg"></i>` +
                            `</button>` +
                            `<img class="preview-img" src="${data.target.result}" style="object-fit: contain" onload="goLastSlide()"/>` +
                            `</div>`;
                        swiper.appendSlide(tempHtml);
                        swiper.update();
                    };

                    reader.readAsDataURL(file);
                }
            }
            if(images.length > 1){
                $('.swiper-controller').show()
            }else {
                $('.swiper-controller').hide()
            }
            if(images.length >= 4){
                $('.uploader').hide()
            }
        }
    }

    function goLastSlide() {
        swiper.slideTo(images.length-1,300,false);
    }

    function deleteImg() {
        $(document).on('click','.delete-img-btn',function () {
            let idx = $(".delete-img-btn").index(this);
            swiper.slideTo(idx-1,300,false);
            swiper.removeSlide(idx);
            swiper.update();
            images.splice(idx,1);

            if(images.length > 1){
                $('.swiper-controller').show()
            }else {
                $('.swiper-controller').hide()
            };

            if(images.length === 0){
                const tempHtml = `<div class="swiper-slide">` +
                    `사진을 추가해주세요.` +
                    `</div>`;
                swiper.appendSlide(tempHtml);
                swiper.update();
            }
            if($('.uploader').css('display') === 'none' && images.length < 4){
                $('.uploader').show()
            }
        })
    }
</script>
</body>
</html>