<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <!--jquery-->
    <script	src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
    <!-- Bootstrap core JS-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Font Awesome icons (free version)-->
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <!-- Bootstrap icons-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css"
          type="text/css"/>
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=Noto+Sans+KR:wght@100;200;300;400;500;600;700;800;900&display=swap"
          rel="stylesheet">
    <!-- Core theme CSS (includes Bootstrap)-->

    <link href="../../../assets/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="../../../assets/css/style.css?after" rel="stylesheet"/>
    <link href="../../../assets/css/commonstyle.css?after" rel="stylesheet"/>

    <title>둘레둘레</title>



    <style>
        *::-webkit-scrollbar {
            width: 5px !important;
        }

        .container-fluid {
            overflow-y: hidden !important;
        }
        ul {
            padding-left: 0 !important;
            margin-bottom: 0 !important;
        }
        .row > * {
            padding-right: 0 !important;
            padding-left: 0 !important;
        }
        .search-scroll {
            overflow: auto;
            height: calc(100vh - 112px);
        }
        .scroll {
            overflow: auto;
            height: calc(100vh - 79px);
            height: calc(100vh - 114px);
        }
        .default {
            width: calc(100% - 380px);
            /* 기본 너비 상태 */
        }
        .plus, .delete {
            background: #fff;
            border: 0px;
            width: 30px;
            height: 30px;
            border-radius: 100%;
        }
        .list-group-item {
            border-width: 0 0 1px 0 !important;
        }

        .toggle-btn {
            border: 0 !important;
            position: absolute;
            width: 30px;
            height: 30px;
            top: 50vh;
            left: 0px;
            z-index: 1000;
            border-radius: 0 5px 5px 0;
        }

        .d-flex:has(.toggle-btn) {
            position: relative;
        }

        #areabox {
            position:relative;
        }

        .select-title {
            width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            line-height: 1.5;
            height: 1.5rem;
        }

        .wide {
            width: 100% !important;
        }
        .search-bar {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 10px;
            margin: 8px;
            align-items: center;
            justify-content: center;
            width: 350px;
        }
        .search-input {
            width: 300px;
            border: none;
            outline: none;
        }
        .search-btn {
            width: 20px;
            height: 20px;
            background: none;
            border: none;
        }
        #your_item {
            position: relative;
            overflow-y: auto;
            overflow-x: hidden;
            height: 100vh;
            max-height: 100vh;
        }
        .overflow-y-auto {
            overflow-y: auto;
        }

        .overflow-x-hidden {
            overflow-x: hidden;
        }

        .map-result {
            z-index: 1001;
        }
        img.thumbnail {
            width: 60px;
            height: 60px;
            object-fit: cover;
        }
        .content-title {
            font-weight: bold;
            width: 220px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            line-height: 1.5;
            height: 1.5rem;
        }
        .content-address {
            font-size: 0.8rem;
            width: 220px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            line-height: 1.5;
            height: 1.5rem;
        }
        .day {
            width: calc(100% - 480px);
        }
        #day {
            justify-content: space-between;
            flex-wrap: wrap;
        }

        .nav-container {
            justify-content: center;
            padding-top: 10px;
        }
        .nav-item {
            padding: 0 !important;
        }
        .btn-2, .btn-3 {
            width: 110px;
            padding: 10px 0px;
            margin: 0 0 10px 0px;
        }
        .btn-4 {
            width: 87px;
            padding: 10px 0px;
            margin: 0 0 10px 10px;
            font-size: 13px;
        }

        .planner-name {
            width: 350px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            line-height: 1.5;
            height: 2rem;
        }
        .planner-date {
            font-size: 0.8rem;
        }
        /*맨왼쪽 바*/
        .nav-link {
            flex-direction: column;
            min-width: auto;
        }
        .login-drop {
            padding: 1rem;
        }
        .profile-img {
            object-fit: cover;
            width: 25px;
            height: 25px;
            border-radius: 50%;
        }
        .dropdown-toggle::after {
            margin-left: 0;
        }
        .ui-state-highlight { height: 1.5em; line-height: 1.2em; }

        .btn_route, .btn_optimize, .btn_delete {
            padding: 5px 10px;
        }
    </style>
</head>
<body>

<script src="https://apis.openapi.sk.com/tmap/jsv2?version=1&appKey=aDVWgep9DE8rL7yokAybK6jrQIiAk9Ln9jI9CTyf"></script>
<script th:inline="javascript">

    // 날짜
    let days = [[${planner.daysBetween}]];

    // 인덱스
    let index;
    // 이전에 선택된 탭의 인덱스를 저장하는 변수
    let previousTabIndex = -1; // 초기값 설정, 아무런 탭도 선택되지 않았음을 나타냄

    // tmap api
    let map;

    // 마커
    let marker = [];

    // 검색 설정 용 탭
    let tabType = 'TOTAL';

    // 찍은 모든 마커
    let viaMarkers = Array.from({length: days}, () => []);

    // 지도 줌
    let bounds;

    // 경유지만 넣는 배열
    let viaPoints = Array.from({length: days}, () => []);

    // 경유지 최적화 실행 시간
    let startTime = getRealTime();

    // 관광지들
    let places = Array.from({length: days}, () => []);

    // 내가 선택한 관광지
    let place;

    // 경로그림정보
    let drawInfoArr = Array.from({length: days}, () => []);
    let resultInfoArr = Array.from({length: days}, () => []);

    // 경로 출력 결과
    let resultText = Array.from({length: days}, () => []);

    // 앱키
    const appKey = "aDVWgep9DE8rL7yokAybK6jrQIiAk9Ln9jI9CTyf";

    console.log(days);


    var plannerName = [[${planner.plannerName}]];
    var startDate = [[${planner.startDate}]];
    var endDate = [[${planner.endDate}]];


    /**
     * 자동 실행 함수
     */
    $(function() {
        switchTabType('TOTAL');
        initTmap();
        addPlace();
        searchItems();
        checkCategory();
        checkSigungu();
        selectAndShow();
        showTourItems();
        listSortable();
        LoadNameAndDay();

        // 엔터 입력 시에도 검색 가능하게 설정
        $('.search-input').on("keydown",function(e){
            if(e.keyCode === 13){
                e.preventDefault();
                $('.search-btn').trigger('click');
            }
        });
    })


    /**
     * sortable 설정
     */
    function listSortable() {
        $('#areabox').sortable({
            placeholder: "ui-state-highlight",
            axis: 'y', // 세로로만 드래그를 허용
            update: function(event, ui) {
                /// 요소의 고유한 ID를 사용하여 places 배열에서 해당 요소를 찾아 재정렬
                var reorderedArray = [];
                $(this).children().each(function() {
                    var itemId = $(this).attr('data-id');
                    var item = places[index].find(function(place) {
                        return place.contentid === itemId;
                    });
                    reorderedArray.push(item);
                });
                places[index] = reorderedArray;
                console.log(places[index]); // 순서가 변경된 배열 로깅

                drawMarkerAgain();
            }
        });
        $('#areabox').disableSelection();

        $(document).on('click', '#areabox button.delete', function() {
            deleteRow(this);
        });
    }

    /**
     * 뷰 관련 기타
     */

    function LoadNameAndDay() {
        $('.planner-name').text(plannerName);
        $('.planner-date').text(startDate + " ~ " + endDate);
    }

    // 토글로 창 접기
    function toggleDay() {
        $('#your_item').toggleClass('d-flex');
        $('#your_item').toggle();
        $('.toggle-btn-icon').toggleClass('bi-caret-right-fill');
        $('.toggle-btn-icon').toggleClass('bi-caret-left-fill');
        // 지도 너비 100%로 고정하기
        $('#map_div').children('div:eq(0)').css('width','100%');
        $('#map_div>div:eq(0)').children('div:eq(0)').css('width','100%');
        $('#map').toggleClass('wide');
    }


    /**
     * 탭 이동
     */
    // 탭타입을 바꿀때마다 버튼스타일을 바꾸고 input 버튼값을 초기화
    function switchTabType(type) {
        tabType = type;
        switch (tabType) {
            case "TOTAL" :
                $('#show-all').addClass('btn-primary')
                    .removeClass('btn-primary2');
                $('#show-bookmark').addClass('btn-primary2')
                    .removeClass('btn-primary');
                totalSearch();
                $('input[name=cat1]').prop('checked', false);
                $('input[name=cat2]').prop('checked', false);
                $('input[name=cat3]').prop('checked', false);
                $('input[name=area]').prop('checked', false);
                $('input[name=sigungu]').prop('checked', false);
                $('input[name=type]').prop('checked', false);
                break;
            case "BOOKMARK" :
                $('#show-bookmark').addClass('btn-primary')
                    .removeClass('btn-primary2');
                $('#show-all').addClass('btn-primary2')
                    .removeClass('btn-primary');
                bookmarkSearch();
                $('input[name=cat1]').prop('checked', false);
                $('input[name=cat2]').prop('checked', false);
                $('input[name=cat3]').prop('checked', false);
                $('input[name=area]').prop('checked', false);
                $('input[name=sigungu]').prop('checked', false);
                $('input[name=type]').prop('checked', false);
                break;
        }
    }

    /**
     * 검색관련
     * api리스트
     */
    // 전체 검색
    function totalSearch() {
        $.ajax({
            url: '/api/planner/touritems',
            type: 'GET',
            contentType: 'application/json; charset=UTF-8',
            data: {
                page: 0
            },
            success: function (data) {
                $('#touritems').replaceWith(data);
            },
            error : function (err){
                console.log(err)
            }
        });
    }

    // 북마크 검색
    function bookmarkSearch() {
        $.ajax({
            url: '/api/planner/bookmark/touritems',
            type: 'GET',
            contentType: 'application/json; charset=UTF-8',
            data: {
                page: 0,
                userId: [[${loginId}]],
            },
            success: function (data) {
                $('#touritems').replaceWith(data);
            },
            error : function (err){
                console.log(err)
            }
        });
    }




    // 검색기능
    function searchItems(){
        $('.search-btn').click(function () {
            let keyword = $('.search-input').val();

            if(tabType == 'TOTAL') {
                $.ajax({
                    url: '/api/planner/touritems',
                    type: 'GET',
                    contentType: 'application/json; charset=UTF-8',
                    data: {
                        page: 0,
                        cat1: $('input[name=cat1]:checked').val(),
                        cat2: $('input[name=cat2]:checked').val(),
                        cat3: $('input[name=cat3]:checked').val(),
                        area: $('input[name=area]:checked').val(),
                        sigungu: $('input[name=sigungu]:checked').val(),
                        type: $('input[name=type]:checked').val(),
                        keyword: keyword
                    },
                    success: function (data) {
                        $('#touritems').replaceWith(data);
                    },
                    error: function (err) {
                        console.log(err)
                    }
                })
            }
            if(tabType == 'BOOKMARK') {
                $.ajax({
                    url: '/api/planner/bookmark/touritems',
                    type: 'GET',
                    contentType: 'application/json; charset=UTF-8',
                    data: {
                        userId: [[${loginId}]],
                        page: 0,
                        cat1: $('input[name=cat1]:checked').val(),
                        cat2: $('input[name=cat2]:checked').val(),
                        cat3: $('input[name=cat3]:checked').val(),
                        area: $('input[name=area]:checked').val(),
                        sigungu: $('input[name=sigungu]:checked').val(),
                        type: $('input[name=type]:checked').val(),
                        keyword: keyword
                    },
                    success: function (data) {
                        $('#touritems').replaceWith(data);
                    },
                    error: function (err) {
                        console.log(err)
                    }
                })
            }
        })
    }


    // 페이지네이션
    function showTourItems(){
        $(document).on('click','.page-item', function (e) {
            const target = e.target;
            let keyword = $('.search-input').val();

            if(tabType == 'TOTAL') {

                if(!target.classList.contains('disabled')){
                    $.ajax({
                        url : '/api/planner/touritems',
                        type: 'GET',
                        contentType : 'application/json; charset=UTF-8',
                        data : {
                            page : target.getAttribute('data-num'),
                            cat1 : $('input[name=cat1]:checked').val(),
                            cat2 : $('input[name=cat2]:checked').val(),
                            cat3 : $('input[name=cat3]:checked').val(),
                            area : $('input[name=area]:checked').val(),
                            sigungu : $('input[name=sigungu]:checked').val(),
                            type : $('input[name=type]:checked').val(),
                            keyword: keyword
                        },
                        success : function(data){
                            // var offset = $('.search-scroll').offset();
                            // $('.search-scroll').animate({scrollTop: (offset.top - $('.search-scroll').height() / 2)}, 500);
                            // $('.search-scroll').scrollTop(0);
                            const html = document.querySelector('html');
                            const div = document.querySelector('.search-scroll');

                            html.scrollTo({top: div.scrollHeight});
                            $('#touritems').replaceWith(data);
                        },
                        error : function (err){
                            console.log(err)
                        }
                    })
                }
            }

            if(tabType == 'BOOKMARK') {
                if (!target.classList.contains('disabled')) {
                    $.ajax({
                        url: '/api/planner/bookmark/touritems',
                        type: 'GET',
                        contentType: 'application/json; charset=UTF-8',
                        data: {
                            userId: [[${loginId}]],
                            page: target.getAttribute('data-num'),
                            cat1: $('input[name=cat1]:checked').val(),
                            cat2: $('input[name=cat2]:checked').val(),
                            cat3: $('input[name=cat3]:checked').val(),
                            area: $('input[name=area]:checked').val(),
                            sigungu: $('input[name=sigungu]:checked').val(),
                            type: $('input[name=type]:checked').val(),
                            keyword: keyword
                        },
                        success: function (data) {
                            // var offset = $('.search-scroll').offset();
                            // $('.search-scroll').animate({scrollTop: (offset.top - $('.search-scroll').height() / 2)}, 500);
                            // $('.search-scroll').scrollTop(0);
                            const html = document.querySelector('html');
                            const div = document.querySelector('.search-scroll');

                            html.scrollTo({top: div.scrollHeight});
                            $('#touritems').replaceWith(data);
                        },
                        error: function (err) {
                            console.log(err);
                        }
                    });
                }
            }
        });
    }

    function checkSigungu() {
        // 지역을 선택하면
        $('.areaSelect').off('click').on('click', function () {
            let areaCode = $(this).val(); // 선택된 지역 코드
            if(areaCode == null) {
                sigunguCode = null;
            }
            let keyword = $('.search-input').val();

            $.ajax({
                url: '/api/planner/sigungu',
                type: 'GET',
                data: {
                    area: areaCode
                },
                success: function(data) {
                    //$("html").scrollTop(0);
                    $('#sigungu').replaceWith(data);
                },
                error: function(err) {
                    console.log(err)
                },
                beforeSend: function (){
                    $('input[type="radio"].sigunguSelect[value=""]').prop("checked", true);
                }
            })
        })
    }

    function checkCategory(){

        // 카테고리(분류) 선택
        $('.catSelect').click(function (){
            const cat1 = $('input[name=cat1]:checked').val() === '' ? null : $('input[name=cat1]:checked').val();
            let keyword = $('.search-input').val();

            $.ajax({
                url : '/api/planner/cat2',
                type: 'GET',
                data : {
                    cat1 : cat1
                },
                success : function(data){
                    $('#category-middle').replaceWith(data);
                },
                error : function (err){
                    console.log(err)
                },
                beforeSend: function (){
                    $('input[type="radio"].cat2Select[value=""]').prop("checked", true);
                }
            })
        })

        // 중분류 선택
        $(document).on('click','.cat2Select',function () {
            const cat1 = $('input[name=cat1]:checked').val() === '' ? null : $('input[name=cat1]:checked').val();
            const cat2 = $('input[name=cat2]:checked').val() === '' ? null : $('input[name=cat2]:checked').val();
            let keyword = $('.search-input').val();

            $.ajax({
                url: '/api/planner/cat3',
                type: 'GET',
                data: {
                    cat2: cat2
                },
                success: function (data) {
                    $('#category-row').replaceWith(data);
                },
                error: function (err) {
                    console.log(err)
                },
                beforeSend: function (){
                    $('input[type="radio"].cat3Select[value=""]').prop("checked", true);
                }
            })
        })
    }

    // 선택한 값에 맞는 결과물 보여주기
    function selectAndShow(){
        $(document).on('click','.select-btn',function () {
            const cat1 = $('input[name=cat1]:checked').val() === '' ? null : $('input[name=cat1]:checked').val();
            let cat2 = $('input[name=cat2]:checked').val() === '' ? null : $('input[name=cat2]:checked').val();
            let cat3 = $('input[name=cat3]:checked').val() === '' ? null : $('input[name=cat3]:checked').val();
            let areaCode = $('input[name=area]:checked').val() === '' ? null : $('input[name=area]:checked').val();
            let sigunguCode = $('input[name=sigungu]:checked').val() === '' ? null : $('input[name=sigungu]:checked').val();
            let keyword = $('.search-input').val();

            if(cat1 == null){
                cat2 = null;
                cat3 = null;
            }
            if(cat2 == null){
                cat3 = null;
            }
            if(areaCode == null) {
                sigunguCode = null;
            }

            if(tabType == 'TOTAL') {
                $.ajax({
                    url: '/api/planner/touritems',
                    type: 'GET',
                    contentType: 'application/json; charset=UTF-8',
                    data: {
                        page: 0,
                        cat1: cat1,
                        cat2: cat2,
                        cat3: cat3,
                        area: areaCode,
                        sigungu: sigunguCode,
                        type: $('input[name=type]:checked').val(),
                        keyword: keyword
                    },
                    success: function (data) {
                        //$("html").scrollTop(0);
                        $('#touritems').replaceWith(data);
                    },
                    error: function (err) {
                        console.log(err)
                    }
                })
            }

            if(tabType == 'BOOKMARK') {
                $.ajax({
                    url: '/api/planner/bookmark/touritems',
                    type: 'GET',
                    contentType: 'application/json; charset=UTF-8',
                    data: {
                        userId : [[${loginId}]],
                        page: 0,
                        cat1: cat1,
                        cat2: cat2,
                        cat3: cat3,
                        area: areaCode,
                        sigungu: sigunguCode,
                        type: $('input[name=type]:checked').val(),
                        keyword: keyword
                    },
                    success: function (data) {
                        //$("html").scrollTop(0);
                        $('#touritems').replaceWith(data);
                    },
                    error: function (err) {
                        console.log(err)
                    }
                })
            }
        })
    }



    /**
     * 담은 아이템을
     * 출력된 목록에서 지우기
     */
    function deleteRow(ths) {
        var ths = $(ths);
        var text = ths.closest('div').find('strong.mb-1').text(); // 선택한 관광지 이름 가져오기
        for (var i = 0; i<viaMarkers[index].length; i++) {
            console.log(viaMarkers[index][i]._marker_data.options.title);
            if(text == viaMarkers[index][i]._marker_data.options.title) { // 선택한 관광지 이름이 viaMarkers[index]의 관광지 이름과 같다면
                ths.closest('div.list-group-item').remove(); // 화면에서 출력되는 목록을 지우기
                viaMarkers[index][i].setMap(null); // 지도에 뜨는 마커를 지우기
                viaMarkers[index].splice(i,1); // 마커 배열에서 삭제하기
                places[index].splice(i,1); // 선택한 관광지 배열에서 삭제하기
            }
        }
        console.log("places[index] : " + places[index]);

        drawMarkerAgain();
        if(resultInfoArr[index].length > 0){ // 관광지 추가할때는 빨간 선을 지우지 않지만, 삭제할때는 빨간 선을 지우는게 좋을 것 같아서 추가했습니다.
            for(var i in resultInfoArr[index]){
                resultInfoArr[index][i].setMap(null); //경로 빨간 선도 찍어놨다면 삭제
            }
            resultInfoArr[index]=[];
        }
    }



    /**
     * tmap
     */
    // 현재 시간을 토대로 이동에 걸리는 시간을 구합니다.
    function getRealTime() {
        var date = new Date();
        var year = date.getFullYear();
        var month = ('0' + (date.getMonth() + 1)).slice(-2);
        var day = ('0' + (date.getDate())).slice(-2);
        var hour = ('0' + (date.getHours())).slice(-2);
        var minute = ('0' + (date.getMinutes())).slice(-2);

        var currentDate = year + month + day + hour + minute
        console.log(currentDate);
        return currentDate;
    }

    // tmap 실행 함수
    function initTmap() {
        map = new Tmapv2.Map("map_div", {
            center: new Tmapv2.LatLng(36.4109466, 128.1590828),
            width: "100%",
            height: "100%",
            zoom: 8,
            zoomControl: true,
            scrollwheel: true
        });

        // 최적화 버튼을 누르면 ajax 실행
        $(".btn_optimize").click(function () {
            // 마커가 3곳 이상이 아니면 실행되지 않도록 막음
            if(viaMarkers[index].length < 3) {
                alert('여행지를 3곳 이상 추가해주세요.');
                return false;
            } else {
                var headers = {};
                headers["appKey"] = appKey;

                viaPoints[index] = []; // 이전 viaPoints[index] 배열을 날리고

                // 시작 장소와 종료 장소
                var start_Mapx = viaMarkers[index][0]._marker_data.options.position._lng;
                var start_Mapy = viaMarkers[index][0]._marker_data.options.position._lat;
                var end_Mapx = viaMarkers[index][viaMarkers[index].length-1]._marker_data.options.position._lng;
                var end_Mapy = viaMarkers[index][viaMarkers[index].length-1]._marker_data.options.position._lat;


                // 마커에 찍힌 경유지를 새로 받는다
                for(var i = 1; i<viaMarkers[index].length-1; i++) {
                    // 하나하나 선택한 경유지
                    var viaPoint = {};
                    viaPoint.viaPointId = i+"경유지";
                    viaPoint.viaPointName = viaMarkers[index][i]._marker_data.options.title;
                    viaPoint.viaX = viaMarkers[index][i]._marker_data.options.position._lng.toString();
                    viaPoint.viaY = viaMarkers[index][i]._marker_data.options.position._lat.toString();
                    console.log("viaPoint : " + viaPoint);

                    viaPoints[index].push(viaPoint); // 지금 담겨진 경로를 viaPoints[index] 에 담는다.
                }
                console.log(viaPoints[index]);


                $.ajax({
                    type: "POST",
                    headers: headers,
                    url: "https://apis.openapi.sk.com/tmap/routes/routeOptimization20?version=1&format=json",
                    async: false,
                    contentType: "application/json",
                    data: JSON.stringify({
                        "startName": "출발",
                        "startX": start_Mapx.toString(),
                        "startY": start_Mapy.toString(),
                        "startTime": startTime,
                        "endName": "도착",
                        "endX": end_Mapx.toString(),
                        "endY": end_Mapy.toString(),
                        "viaPoints": viaPoints[index],
                        "reqCoordType" : "WGS84GEO",
                        "resCoordType" : "EPSG3857"
                    }),
                    success:function(response){
                        var resultData = response.properties;
                        var resultFeatures = response.features;

                        // 결과 출력
                        var tDistance = "총 거리 : " + (resultData.totalDistance/1000).toFixed(1) + "km,  ";
                        var tTime = "총 시간 : " + (resultData.totalTime/60).toFixed(0) + "분,  ";
                        var tFare = "총 요금 : " + resultData.totalFare + "원";

                        resultText[index] = tDistance+tTime+tFare;
                        $(".result").text(resultText[index]);

                        // 기존 라인 초기화
                        if(resultInfoArr[index].length > 0){
                            for(var i in resultInfoArr[index]){
                                resultInfoArr[index][i].setMap(null);
                            }
                            resultInfoArr[index]=[];
                        }

                        var PTbounds = new Tmapv2.LatLngBounds();
                        for(var i in resultFeatures) {
                            var geometry = resultFeatures[i].geometry;
                            var polyline_ = Array.from({length: days}, () => []);
                            drawInfoArr[index] = [];

                            // 지도 레벨과 경로를 함께 조정
                            if(geometry.type == "LineString") {
                                for(var j in geometry.coordinates){
                                    // 경로들의 결과값(구간)들을 포인트 객체로 변환
                                    var latlng = new Tmapv2.Point(geometry.coordinates[j][0], geometry.coordinates[j][1]);
                                    // 포인트 객체를 받아 좌표값으로 변환
                                    var convertPoint = new Tmapv2.Projection.convertEPSG3857ToWGS84GEO(latlng);
                                    // 포인트객체의 정보로 좌표값 변환 객체로 저장
                                    var convertChange = new Tmapv2.LatLng(convertPoint._lat, convertPoint._lng);

                                    // console.log("latlng : " + latlng);
                                    // console.log("convertPoint : " + convertPoint);
                                    // console.log("convertChange : " + convertChange);

                                    bounds = convertChange;
                                    drawInfoArr[index].push(convertChange);

                                    // 경유지 최적화 결과 반경만큼 지도 레벨 조정
                                    var linePt = new Tmapv2.LatLng(bounds._lat, bounds._lng);
                                    PTbounds.extend(linePt);
                                }

                                polyline_[index] = new Tmapv2.Polyline({
                                    path : drawInfoArr[index],
                                    strokeColor : "#FF0000",
                                    strokeWeight: 6,
                                    map : map
                                });
                                resultInfoArr[index].push(polyline_[index]);
                                var paddingOptions = {
                                    top: 40, // 상단 패딩
                                    right: 40, // 우측 패딩
                                    bottom: 40, // 하단 패딩
                                    left: 40 // 좌측 패딩
                                };
                                map.fitBounds(PTbounds, paddingOptions);
                            }
                        }
                    },
                    error:function(request,status,error){
                        console.log("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
                    }
                });
            }
        })



        // 경로 보기 버튼을 누르면 ajax 실행
        $(".btn_route").click(function () {
            // 마커가 3곳 이상이 아니면 실행되지 않도록 막음
            if(viaMarkers[index].length < 3) {
                alert('여행지를 3곳 이상 추가해주세요.');
                return false;
            } else {
                var headers = {};
                headers["appKey"] = appKey;

                viaPoints[index] = []; // 이전 viaPoints[index] 배열을 날리고

                // 시작 장소와 종료 장소
                var start_Mapx = viaMarkers[index][0]._marker_data.options.position._lng;
                var start_Mapy = viaMarkers[index][0]._marker_data.options.position._lat;
                var end_Mapx = viaMarkers[index][viaMarkers[index].length-1]._marker_data.options.position._lng;
                var end_Mapy = viaMarkers[index][viaMarkers[index].length-1]._marker_data.options.position._lat;

                // 마커에 찍힌 경유지
                for(var i = 1; i<viaMarkers[index].length-1; i++) {
                    var viaPoint = {};
                    viaPoint.viaPointId = i+"경유지";
                    viaPoint.viaPointName = viaMarkers[index][i]._marker_data.options.title;
                    viaPoint.viaX = viaMarkers[index][i]._marker_data.options.position._lng.toString();
                    viaPoint.viaY = viaMarkers[index][i]._marker_data.options.position._lat.toString();
                    console.log(viaPoint);

                    viaPoints[index].push(viaPoint); // 지금 담겨진 경로를 viaPoints[index] 에 담는다.
                }
                console.log(viaPoints[index]);


                $.ajax({
                    type: "POST",
                    headers: headers,
                    url: "https://apis.openapi.sk.com/tmap/routes/routeSequential30?version=1&format=json",
                    async: false,
                    contentType: "application/json",
                    data: JSON.stringify({
                        "startName": "출발",
                        "startX": start_Mapx.toString(),
                        "startY": start_Mapy.toString(),
                        "startTime": startTime,
                        "endName": "도착",
                        "endX": end_Mapx.toString(),
                        "endY": end_Mapy.toString(),
                        "viaPoints": viaPoints[index]
                    }),
                    success:function(response){
                        var resultData = response.properties;
                        var resultFeatures = response.features;

                        // 결과 출력
                        var tDistance = "총 거리 : " + (resultData.totalDistance/1000).toFixed(1) + "km,  ";
                        var tTime = "총 시간 : " + (resultData.totalTime/60).toFixed(0) + "분,  ";
                        var tFare = "총 요금 : " + resultData.totalFare + "원";

                        resultText[index] = tDistance+tTime+tFare;
                        $(".result").text(resultText[index]);

                        // 기존 라인 초기화
                        if(resultInfoArr[index].length > 0){
                            for(var i in resultInfoArr[index]){
                                resultInfoArr[index][i].setMap(null);
                            }
                            resultInfoArr[index]=[];
                        }

                        var PTbounds = new Tmapv2.LatLngBounds();
                        for(var i in resultFeatures) {
                            var geometry = resultFeatures[i].geometry;
                            var polyline_ = Array.from({length: days}, () => []);
                            drawInfoArr[index] = [];

                            // 지도 레벨과 경로를 함께 조정
                            if(geometry.type == "LineString") {
                                for(var j in geometry.coordinates){
                                    // 경로들의 결과값(구간)들을 포인트 객체로 변환
                                    var point = new Tmapv2.LatLng(geometry.coordinates[j][1],geometry.coordinates[j][0]);

                                    bounds = point;
                                    drawInfoArr[index].push(point);

                                    // 경유지 최적화 결과 반경만큼 지도 레벨 조정
                                    var linePt = new Tmapv2.LatLng(bounds._lat, bounds._lng);
                                    PTbounds.extend(linePt);
                                }

                                polyline_[index] = new Tmapv2.Polyline({
                                    path : drawInfoArr[index],
                                    strokeColor : "#FF0000",
                                    strokeWeight: 6,
                                    map : map
                                });
                                resultInfoArr[index].push(polyline_[index]);

                                var paddingOptions = {
                                    top: 40, // 상단 패딩
                                    right: 40, // 우측 패딩
                                    bottom: 40, // 하단 패딩
                                    left: 40 // 좌측 패딩
                                };
                                map.fitBounds(PTbounds, paddingOptions);
                            }
                        }
                    },
                    error:function(request,status,error){
                        console.log("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
                    }
                });
            }
        })


        // 전체 관광지 삭제하기 버튼을 누르면 모든 마커를 삭제
        $(".btn_delete").click(function () {
            deleteMarkers();
        })
    }

    /**
     * 마커
     */

    // 마커 제거 후 다시 줌
    function drawMarkerAgain() {
        viaMarkers[index].forEach(function (marker) {
            marker.setMap(null); // TMap에서 마커 제거
        });
        viaMarkers[index] = []; // viaMarkers 배열 초기화

        for(var i = 0; i<places[index].length; i++) {
            addMarker(i+1, places[index][i]) // 마커 다시 찍기
        }
        fitBoundsToMarkers();
    }

    // 모든 마커가 추가된 후에 fitBounds 함수 호출
    function fitBoundsToMarkers() {
        if(viaMarkers[index].length > 0) {
            if(viaMarkers[index].length == 1) {
                map.setCenter(viaMarkers[index][0].getPosition());
                map.setZoom(10); // 마커가 하나 뿐이면 그것만 줌
            } else {
                var PTbounds = new Tmapv2.LatLngBounds();
                for (var dayIndex = 0; dayIndex < viaMarkers.length; dayIndex++) {
                    if (viaMarkers[dayIndex].length > 0) {
                        for (var i = 0; i < viaMarkers[dayIndex].length; i++) {
                            var marker = viaMarkers[dayIndex][i];
                            PTbounds.extend(marker.getPosition());
                        }
                    }
                }
                var paddingOptions = {
                    top: 40, // 상단 패딩
                    right: 40, // 우측 패딩
                    bottom: 40, // 하단 패딩
                    left: 40 // 좌측 패딩
                };
                map.fitBounds(PTbounds, paddingOptions);
            }
        }
    }


    // 마커 삭제하기 함수
    function deleteMarkers() {
        for (var i=0; i<viaMarkers[index].length; i++) {
            viaMarkers[index][i].setMap(null);
        }
        // 등록된 마커 배열도 초기화
        viaMarkers[index] = [];
        // 장소 배열도 초기화
        places[index] = [];
        place = null;
        // 출력된 목록도 초기화
        $('#areabox').empty();

        if(resultInfoArr[index].length > 0){
            for(var i in resultInfoArr[index]){
                resultInfoArr[index][i].setMap(null);
            }
            resultInfoArr[index]=[];
        }
        $('.result').empty(); // 결과 값 비우기
    }

    // 마커 추가하기 함수
    function addMarker(status, info) {
        // status 에 따라 아이콘 바꾸기
        imgUrl = `https://tmapapi.tmapmobility.com/upload/tmap/marker/pin_b_m_${status}.png`;

        // 관광지 목록에 추가한 대로 marker 생성
        marker = new Tmapv2.Marker({
            position: new Tmapv2.LatLng(info.mapy, info.mapx),
            icon: imgUrl,
            iconSize: new Tmapv2.Size(24, 38),
            map: map,
            title: info.title
        })
        viaMarkers[index].push(marker);
    }

    // 목록에서 선택하여 장소 추가하기
    function addPlace() {
        $(document).on('click','.plus',function () {
            if(places[index].length < 9) {
                // 이름 가져오기
                const areaname = $(this).prev('div').find('.content-title').text();
                console.log(areaname);

                // 위치 가져오기
                const mapx = $(this).prev('div').children('input').eq(0).val();
                const mapy = $(this).prev('div').children('input').eq(1).val();
                const contentid = $(this).prev('div').children('input').eq(2).val();
                console.log(mapx, mapy, contentid);

                // 지금 선택한 장소
                place = {
                    title: areaname,
                    contentid: contentid,
                    mapx: mapx,
                    mapy: mapy
                }

                console.log(place);


                // 중복 체크
                var isDuplicate = places[index].some(function (p) {
                    return p.title === place.title;
                });

                if (!isDuplicate) {
                    // 중복이 아닐 경우에만 관광지 목록에 내가 선택한 관광지를 추가하고
                    places[index].push(place);
                    // 출력한다
                    addPrintDayList();

                    // 선택한 관광지가 1개 ~ 9개일 경우에만
                    if (places[index].length >= 1) {
                        drawMarkerAgain();
                    }
                } else {
                    alert('이미 추가된 장소입니다.');
                }
            } else { // 관광지 등록은 9개까지만
                alert('관광지는 최대 9개까지 등록 가능합니다.');
            }
        });
    }

    function addPrintDayList() {
        $('#areabox').empty(); // 반복문 시작 전에 출력된 목록을 지우고

        places[index].forEach(function (data) { // places[index] 배열에 있는 모든 오브젝트를 반복문을 돌려 출력합니다
            var template = `
                        <div class='list-group-item list-group-item-action py-3 lh-tight' aria-current='true' data-id='${data.contentid}'>
                            <div class='d-flex w-100 align-items-center justify-content-between'>
                                <strong class='mb-1 select-title'>${data.title}</strong>
                                <button class='delete' type='button' onclick='deleteRow(this);'>
                                    <i class='bi bi-x-circle'></i>
                                </button>
                            </div>
                        </div>
                        `;
            $('#areabox').append(template); // 계속해서 추가한다.
        });
    }



    /**
     * 탭 이동, 저장 및 취소
     */
    document.addEventListener("DOMContentLoaded", function () {
        // 각 탭 요소들을 선택
        var tabs = document.querySelectorAll('.day-nav');
        // 첫 번째 탭을 활성화하고 해당 내용을 보이도록 설정
        tabs[0].classList.add('active');
        $('#your_day').html("DAY1");
        index = 0;
        previousTabIndex = -1; // 이전 탭의 인덱스를 초기화

        // 각 탭에 대해 클릭 이벤트 리스너 추가
        tabs.forEach(function (tab, tabIndex) {
            tab.addEventListener('click', function () {
                previousTabIndex = index;
                index = tabIndex; // 현재 선택한 탭의 인덱스
                // 모든 탭에서 'active' 클래스 제거
                tabs.forEach(function(otherTab) {
                    otherTab.classList.remove('active');
                });
                // 현재 클릭된 탭에만 'active' 클래스 추가
                tab.classList.add('active');


                // 현재 클릭된 탭이 이전 탭과 다를 경우에만 실행
                if (previousTabIndex !== index) {
                    // 이전 탭에서 마커와 경로가 이미 있다면 제거
                    if (viaMarkers[previousTabIndex] && viaMarkers[previousTabIndex].length > 0) {
                        viaMarkers[previousTabIndex].forEach(function (marker) {
                            marker.setMap(null); // TMap에서 이전 탭 마커 제거
                        });
                        viaMarkers[previousTabIndex] = []; // viaMarkers 배열 초기화
                    }
                    if (resultInfoArr[previousTabIndex] && resultInfoArr[previousTabIndex].length > 0) {
                        resultInfoArr[previousTabIndex].forEach(function (line) {
                            line.setMap(null); // TMap에서 이전 탭 경로 빨간 선 제거
                        })
                        $(".result").text(""); // 총 거리, 시간, 요금 결과 제거
                    }

                    var yourDay = "DAY" + (index + 1).toString(); // 담은 장소가 몇일째인지 띄워줌
                    $('#your_day').html(yourDay);

                    // 현재탭의 목록 불러오기
                    addPrintDayList();

                    // 마커 다시 찍기
                    for(var i = 0; i<places[index].length; i++) {
                        addMarker(i+1, places[index][i])
                    }
                    // 지도를 해당 마커를 중심으로 기본 줌 레벨로 확대
                    fitBoundsToMarkers();

                    // 현재 선택한 탭에 맞는 경로 빨간 선 표시를 다시 로드
                    resultInfoArr[index].forEach(function (line) {
                        line.setMap(map);
                    })

                    // 현재 선택한 탭에 맞는 총 거리, 시간, 요금 결과를 다시 로드
                    $(".result").text(resultText[index]); // 총 거리, 시간, 요금 결과 제거

                    // 이전 탭의 인덱스를 업데이트
                    previousTabIndex = index;
                }
            });
        });

        // 다음 버튼 클릭시 실행
        $("#next-btn").click(function () {
            // 모든 탭에서 장소를 추가한 경우에만 데이터 저장
            var allPlacesAdded = places.every(function (placeList) {
                return placeList.length > 0;
            });
            if (allPlacesAdded) {
                $.ajax({
                    type: "POST", // HTTP 요청 방식
                    url: "/api/planner", // 데이터를 전송할 서버의 URL
                    contentType: "application/json", // 전송할 데이터의 타입
                    data: JSON.stringify({
                        plannerName: plannerName,
                        startDate: startDate,
                        endDate: endDate,
                        plans: places.flatMap(function (place, index) {
                            return place.map(function (subPlace, subIndex) {
                                return {
                                    day: index + 1, // day 값 설정
                                    order: subIndex + 1, // order 값 설정
                                    contentId: subPlace.contentid
                                };
                            });
                        })
                    }), // 전송할 데이터
                    success: function (response) { // 요청이 성공적으로 완료되었을 때 실행될 함수
                        var p_id = response.plannerId; // 응답에서 p_id 추출
                        // p_id를 파라미터로 포함하는 새로운 URL로 페이지 이동
                        window.location.href = '/plan/show?p_id=' + p_id;
                        console.log('성공');
                    },
                    error: function (xhr, status, error) { // 요청이 실패했을 때 실행될 함수
                        console.log(xhr, status, error);
                        alert('실패');
                    }
                });
            } else {
                alert('모든 여행일자에 장소를 추가해주세요.');
            }
        });
    });


</script>


<div class="container-fluid">

    <!-- Modal -->
    <div class="modal fade" id="selectModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog  modal-dialog-scrollable" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">검색설정</h5>
                    <button type="button" class="btn btn-sm close" data-bs-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div>
                        <h4>지역</h4>
                        <div id="area-list-box">
                            <input type="radio" class="areaSelect btn-check select-btn" name="area" id="area0" autocomplete="off" value="" checked>
                            <label class="btn btn-2" for="area0" th:text="전체"></label>
                            <th:block th:each="area, idx : ${areaList}">
                                <input type="radio" class="areaSelect btn-check select-btn" name="area" th:id="|area${idx.count}|" autocomplete="off" th:value="${area.areaCode}">
                                <label class="btn btn-2" th:for="|area${idx.count}|" th:text="|${area.areaName}|"></label>
                            </th:block>
                        </div>
                        <div id="sigungu">
                            <div id="sigunguSelector" th:if="${sigunguList.size() > 0}">
                                <h5>- 상세 지역 -</h5>
                                <input type="radio" class="sigunguSelect btn-check select-btn" name="sigungu" id="sigungu0" autocomplete="off" value="" checked>
                                <label class="btn btn-2" for="sigungu0" th:text="전체"></label>
                                <th:block th:each="sigungu, idx : ${sigunguList}">
                                    <input type="radio" class="sigunguSelect btn-check select-btn" name="sigungu" th:id="|sigungu${idx.count}|" autocomplete="off" th:value="${sigungu.sigunguCode}">
                                    <label class="btn btn-2" th:for="|sigungu${idx.count}|" th:text="${sigungu.sigunguName}"></label>
                                </th:block>
                            </div>
                        </div>
                        <div id="tagSelector">
                            <div id="content_type">
                                <h5>- 관광 타입 -</h5>
                                <input type="radio" class="typeSelect btn-check select-btn" name="type" id="type0" autocomplete="off" value="" checked>
                                <label class="btn btn-2" for="type0" th:text="전체"></label>
                                <th:block th:each="type, idx : ${contentTypeList}">
                                    <input type="radio" class="typeSelect btn-check select-btn" name="type" th:id="|type${idx.count}|" autocomplete="off" th:value="${type.contentTypeId}">
                                    <label class="btn btn-2" th:for="|type${idx.count}|" th:text="${type.contentTypeName}"></label>
                                </th:block>
                            </div>
                            <div id="category">
                                <div id="cat1Selector">
                                    <h5>- 대분류 -</h5>
                                    <div>
                                        <input type="radio" class="catSelect btn-check select-btn" name="cat1" id="cat1-0" autocomplete="off" value="" checked>
                                        <label class="btn btn-2" for="cat1-0" th:text="전체"></label>
                                        <th:block th:each="cat1, idx : ${cat1List}">
                                            <input type="radio" class="catSelect btn-check select-btn" name="cat1" th:id="|cat1-${idx.count}|" autocomplete="off" th:value="${cat1.cat1}">
                                            <label class="btn btn-2" th:for="|cat1-${idx.count}|" th:text="${cat1.cat1Name}"></label>
                                        </th:block>
                                    </div>

                                </div>

                                <div id="category-middle">
                                    <div id="cat2Selector" th:if="${cat2List.size() > 0}">
                                        <h5>- 중분류 -</h5>
                                        <input type="radio" class="cat2Select btn-check select-btn" name="cat2" id="cat2-0" autocomplete="off" value="" checked>
                                        <label class="btn btn-2" for="cat2-0" th:text="전체"></label>
                                        <th:block th:each="cat2, idx : ${cat2List}">
                                            <input type="radio" class="cat2Select btn-check select-btn" name="cat2" th:id="|cat2-${idx.count}|" autocomplete="off" th:value="${cat2.cat2}">
                                            <label class="btn btn-2" th:for="|cat2-${idx.count}|" th:text="${cat2.cat2Name}"></label>
                                        </th:block>
                                    </div>
                                    <div id="category-row">
                                        <div id="cat3Selector" th:if="${cat3List.size() > 0}">
                                            <h5>- 소분류 -</h5>
                                            <input type="radio" class="cat3Select btn-check select-btn" name="cat3" id="cat3-0" autocomplete="off" value="" checked>
                                            <label class="btn btn-2" for="cat3-0" th:text="전체"></label>
                                            <th:block th:each="cat3, idx : ${cat3List}">
                                                <input type="radio" class="cat3Select btn-check select-btn" name="cat3" th:id="|cat3-${idx.count}|" autocomplete="off" th:value="${cat3.cat3}">
                                                <label class="btn btn-2" th:for="|cat3-${idx.count}|" th:text="${cat3.cat3Name}"></label>
                                            </th:block>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!--한줄로 정렬합니다.-->
    <div class="row">
        <!--여행 몇일차인지-->
        <div class="vh-100 d-flex flex-column bg-light" style="width: 100px;">
            <a href="*" class="d-block p-3 link-dark text-decoration-none text-center" title="" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-original-title="Icon-only">
                일정
            </a>
            <ul class="nav nav-pills nav-flush flex-column mb-auto text-center">

                <!-- 반복하여 탭 생성 -->
                <th:block th:each="i : ${#numbers.sequence(1, planner.daysBetween)}">
                    <li class="nav-item" role="presentation">
                        <a href="#" class="day-nav nav-link py-3 border-bottom" aria-current="page" th:data-day="${i}" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-original-title="Day" th:text="'Day ' + ${i}">
                        </a>
                    </li>
                </th:block>

            </ul>
            <div class="btn_con text-center">
                <button type="button" id="next-btn" class="btn btn-primary" >저장</button>
            </div>
            <div class="dropdown">
                <div class="login-drop dropdown mt-auto">
                    <hr>
                    <a href="#"
                       class=" d-flex justify-content-center align-items-center text-decoration-none dropdown-toggle nav-link"
                       data-bs-toggle="dropdown" aria-expanded="false">
                        <th:block sec:authorize="isAuthenticated()">
                            <img th:if="${#authentication.principal.profileImg == null}" src="/assets/img/profile.jpg" class="profile-img rounded-circle" alt="프로필 이미지">
                            <img th:unless="${#authentication.principal.profileImg == null}" th:src="|@{/api/image/profile/}${#authentication.principal.profileImg}|" class="profile-img rounded-circle me-2" alt="프로필 이미지">
                            <strong th:text="${#authentication.principal.name}"></strong>
                        </th:block>
                        <th:block sec:authorize="isAnonymous()">
                            <i class="bi bi-person-circle text-dark"></i>
                            <strong>로그인</strong>
                        </th:block>
                    </a>
                    <ul class="dropdown-menu text-small shadow">
                        <th:block sec:authorize="isAnonymous()">
                            <li><a class="dropdown-item" href="/login">로그인</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item" href="/join">회원가입</a></li>
                        </th:block>
                        <th:block sec:authorize="isAuthenticated()">
                            <li><a class="dropdown-item" href="/editprofile">profile</a></li>
                            <li><a class="dropdown-item" href="/changePw">setting</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item" href="/logout">로그아웃</a></li>
                        </th:block>
                    </ul>
                </div>
            </div>
        </div>



            <!--장소찾기-->
            <div id="select_item" class="vh-100 d-flex flex-column align-items-stretch bg-white" style="width: 380px;">
                <div class="d-flex flex-column p-3">
                    <span class="fs-5 fw-semibold planner-name">플래너 이름</span>
                    <span class="planner-date text-secondary">날짜</span>
                </div>
                <div class="search-bar">
                    <input class="search-input" placeholder="장소를 검색하세요.">
                    <button class="search-btn" type="submit"><i class="bi bi-search"></i></button>
                </div>
                <div class="flex-box">
                    <!--장소선택이 들어가야 하는 부분-->
                    <div class="wrap">
                        <div class="flex-box">
                            <h2 id="areaName"></h2>
                            <!-- 선택하면 옵션을 설정하는 모달을 띄웁니다. -->
                            <button type="button" class="btn btn-4 btn-primary2" id="show-all" onclick="switchTabType('TOTAL')">통합검색</button>
                            <button type="button" class="btn btn-4 btn-primary2" id="show-bookmark" onclick="switchTabType('BOOKMARK')">내 북마크 검색</button>
                            <button type="button" class="btn btn-4 btn-primary2 btn-select-area " id="morebtn" data-bs-toggle="modal" data-bs-target="#selectModal">검색설정</button>
                        </div>
                    </div>
                </div>

                <div class="search-scroll list-group list-group-flush border-bottom scrollarea">
                    <div class="flex overflow-x-hidden">
                        <!--장소 불러오기-->
                        <div id="touritems">
                            <div>
                                <span class="fs-5 fw-semibold ps-3" th:text="|${pageResponse.total}건의 관광지|"></span>
                            </div>

                            <th:block th:if="${pageResponse.total > 0}" th:each="touritem : ${pageResponse.dtoList}">

                                <!--선택된 객체에는 active 클래스를 주면 파란 배경이 됨-->
                                <div class="list-group-item list-group-item-action py-3 lh-tight" aria-current="true">
                                    <div class="d-flex w-100 align-items-center justify-content-between">
                                        <!-- 이미지 출력하기 -->
                                        <div style="width: 60px; height: 60px;">
                                            <img class="thumbnail" th:if="${touritem.firstimage == null || touritem.firstimage.isEmpty()}" src="../../../assets/img/no_img.jpg">
                                            <img class="thumbnail" th:unless="${touritem.firstimage == null || touritem.firstimage.isEmpty()}" th:src="${touritem.firstimage}">
                                        </div>

                                        <div th:title="${touritem.title}" class="ps-3">
                                            <input type="hidden" th:id="|mapx${touritem.contentid}|" th:value="${touritem.mapx}">
                                            <input type="hidden" th:id="|mapy${touritem.contentid}|" th:value="${touritem.mapy}">
                                            <input type="hidden" th:id="|contentId${touritem.contentid}|" th:value="${touritem.contentid}">
                                            <a th:href="@{/tour/content/{contentid}(contentid=${touritem.contentid})}">
                                                <div class="content-title" th:text="${touritem.title}"></div>
                                            </a>
                                            <p class="content-address" th:text="${touritem.address}"></p>
                                        </div>

                                        <button class="plus">
                                            <!--아이콘 눌러서 담기-->
                                            <i class="bi bi-bookmark-plus"></i>
                                        </button>
                                    </div>
                                    <div class="col-10 mb-1 small" >
                                        <label th:text="${touritem.fullCategoryName}"></label>
                                    </div>
                                </div>
                            </th:block>


                            <th:block th:unless="${pageResponse.total > 0}">
                                <p class="mb-1 touritem-no-contents">
                                    검색된 관광지 정보가 없습니다.
                                </p>
                            </th:block>

                            <div class="nav-container">
                                <nav aria-label="page-bar">
                                    <ul class="pagination">
                                        <li class="page-item">
                                            <i class="bi bi-chevron-double-left page-link" data-num="0"></i>
                                        </li>
                                        <li class="page-item" th:classappend="${pageResponse.prev} ? '' : 'disabled'">
                                            <i class="bi bi-chevron-left page-link" th:attr="data-num=${pageResponse.start -1}"></i>
                                        </li>
                                        <th:block th:each="pageNo : ${#numbers.sequence(pageResponse.start, pageResponse.end)}">
                                            <li class="page-item"><span class="page-link" th:attr="data-num=${pageNo}" th:classappend="${pageResponse.page == pageNo} ? 'active' : ''" th:text="${pageNo + 1}"></span></li>
                                        </th:block>
                                        <li class="page-item" th:classappend="${pageResponse.next} ? '' : 'disabled'">
                                            <i class="bi bi-chevron-right page-link" th:attr="data-num=${pageResponse.end +1}"></i>
                                        </li>
                                        <li class="page-item">
                                            <i class="bi bi-chevron-double-right page-link" th:attr="data-num=${pageResponse.last}"></i>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
            </div>



                <div id="day" class="day vh-100 d-flex flex-column">
                    <!--장소담기-->
                    <div id="your_item" class="vh-100 d-flex flex-column align-items-stretch bg-white" style="width: 380px;">
                        <a href="/" class="d-flex align-items-center flex-shrink-0 p-3 link-dark text-decoration-none border-bottom">
                            <span class="fs-5 fw-semibold" id="your_day"></span>
                        </a>

                        <!--버튼눌러서 담으면 이렇게 됩니다.-->
                        <!--            <div id="areabox" class="scroll list-group list-group-flush border-bottom scrollarea">-->
                        <!--                <a href="#" class="list-group-item list-group-item-action active py-3 lh-tight" aria-current="true">-->
                        <!--                    <div class="d-flex w-100 align-items-center justify-content-between">-->
                        <!--                        <strong class="mb-1">장소1</strong>-->
                        <!--                        <small>-->
                        <!--아이콘 눌러서 담기-->
                        <!--                            <button id="deleteBtn" type="button" onclick="deleteRow(this);">-->
                        <!--                                <i class='bi bi-x-circle'></i>-->
                        <!--                            </button>-->
                        <!--                        </small>-->
                        <!--                    </div>-->
                        <!--                </a>-->
                        <!--            </div>-->

                        <div id="areabox" class="scroll list-group list-group-flush scrollarea">
                        </div>
                    </div>

                    <!--지도가 들어갑니다.-->
                    <div id="map" class="vh-100 d-flex flex-column align-items-stretch default">
                        <button class="toggle-btn bg-white text-center" type="button" onclick="toggleDay();">
                            <i class="toggle-btn-icon bi bi-caret-left-fill"></i>
                        </button>

                        <div class="map-result position-absolute">
                            <p class="result"></p>
                            <button class="btn btn-primary btn_route">경로 확인</button>
                            <button class="btn btn-primary btn_optimize">동선 추천</button>
                            <button class="btn btn-danger btn_delete">전체 삭제</button>
                        </div>
                        <div id="map_div">
                        </div>
                    </div>
                </div>
            </th:block>
        </div>
    </div>
</div>
</body>
</html>