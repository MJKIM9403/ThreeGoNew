<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- Bootstrap core JS-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <!--jquery-->
    <script	src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <!-- Font Awesome icons (free version)-->
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <!-- Bootstrap icons-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css"
          type="text/css"/>
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=Noto+Sans+KR:wght@100;200;300;400;500;600;700;800;900&display=swap"
          rel="stylesheet">
    <!-- Core theme CSS (includes Bootstrap)-->

    <link href="../../../assets/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="../../../assets/css/style.css?after" rel="stylesheet"/>
    <link href="../../../assets/css/commonstyle.css?after" rel="stylesheet"/>

    <title>Three Go</title>
</head>
<body>

<script src="https://apis.openapi.sk.com/tmap/jsv2?version=1&appKey=aDVWgep9DE8rL7yokAybK6jrQIiAk9Ln9jI9CTyf"></script>
<script th:inline="javascript">
    // 담은 아이템 지우는 함수
    function deleteRow(ths) {
        var ths = $(ths);
        var text = ths.closest('a').find('strong.mb-1').text();
        console.log(text);
        for (var i = 0; i<viaMarkers.length; i++) {
            console.log(viaMarkers[i]._marker_data.options.title);
            if(text == viaMarkers[i]._marker_data.options.title) {
                ths.closest("a").remove(); // 화면에서 출력되는 목록을 지우기
                viaMarkers[i].setMap(null); // 지도에 뜨는 마커를 지우기
                viaMarkers.splice(i,1); // 마커 배열에서 삭제하기
                places.splice(i,1); // 선택한 관광지 배열에서 삭제하기
            }
        }
    }



    // 창 토글로 접는 함수
    function toggleDay() {
        $('#your_item').toggleClass('d-flex');
        $('#your_item').toggle();
        $('#toggle-btn-icon').toggleClass('bi-caret-right-fill');
        $('#toggle-btn-icon').toggleClass('bi-caret-left-fill');
        // 지도 너비 100%로 고정하기
        $('#map_div').children('div:eq(0)').css('width','100%');
        $('#map_div>div:eq(0)').children('div:eq(0)').css('width','100%');
        $('#map').toggleClass('wide');
    }


    // 날짜
    var days = [[${daysBetween}]];

    // 인덱스
    var index;

    // tmap api
    var maps = [];

    // 마커
    var marker = [];

    // 경유지
    var viaMarkers = new Array(days).fill([]);

    // 관광지들
    var places = new Array(days).fill([]);

    // 내가 선택한 관광지
    var place;

    // 경로그림정보
    var drawInfoArr = [];
    var resultInfoArr = [];

    // for(var i = 1; i <= days; i++) {
    //     maps[`map`+i] = {};
    //     viaMarkers['viaMarkers'+i] = {};
    //     marker['marker'+i] = {};
    //     places['places'+i] = {};
    //     place['place'+i] = {};
    //     drawInfoArr['drawInfoArr'+i] = {};
    //     resultInfoArr['resultInfoArr'+i] = {};
    // }
    console.log(days);


    // 현재 시간을 토대로 이동에 걸리는 시간을 구합니다.
    function getRealTime() {
        var date = new Date();
        var year = date.getFullYear();
        var month = ('0' + (date.getMonth() + 1)).slice(-2);
        var day = ('0' + (date.getDate())).slice(-2);
        var hour = ('0' + (date.getHours())).slice(-2);
        var minute = ('0' + (date.getMinutes())).slice(-2);

        var currentDate = year + month + day + hour + minute
        console.log(currentDate);
        return currentDate;
    }
    function initTmap2(mapId) {

            map = new Tmapv2.Map(mapId, {
                center: new Tmapv2.LatLng(36.4109466, 128.1590828),
                width: "100%",
                height: "100%",
                zoom: 8,
                zoomControl: true,
                scrollwheel: true
            });

            maps.push(map);

            // 아이콘 누르면 장소 담기에 추가하는 함수
            $(document).ready(function () {
                $('.plus').click(function () {
                    // 이름 가져오기
                    const areaname = $(this).prev('div').children('div').text();
                    console.log(areaname);

                    // 위치 가져오기
                    const mapx = $(this).prev('div').children('input').eq(0).val();
                    const mapy = $(this).prev('div').children('input').eq(1).val();
                    console.log(mapx, mapy);

                    // 지금 선택한 장소
                    place = {
                        title : areaname,
                        mapx: mapx,
                        mapy: mapy
                    }

                    console.log(place);
                    // 중복 체크
                    var isDuplicate = places.some(function(p) {
                        return p.title === place.title;
                    });

                    if (!isDuplicate) {
                        // 중복이 아닐 경우에만 관광지 목록에 내가 선택한 관광지를 추가하고
                        places[index].push(place);
                        // 출력한다
                        $("#areabox").append("<a href='#' class='list-group-item list-group-item-action py-3 lh-tight' aria-current='true'> <div class='d-flex w-100 align-items-center justify-content-between'> <strong class='mb-1'>" + areaname + "</strong> <button class='delete' type='button' onclick='deleteRow(this);'><i class='bi bi-x-circle'></i></button> </div> </a>")

                        // 선택한 관광지가 1개 이상일 경우에만
                        if (places[index].length >= 1) {
                            // 기존 마커 제거
                            viaMarkers[index].forEach(function(marker) {
                                marker.setMap(null); // TMap에서 마커 제거
                            });
                            viaMarkers[index]  = []; // viaMarkers 배열 초기화

                            addMarker("start", places[index][0]);
                            for (var j = 1; j < places[index].length - 1; j++) {
                                addMarker("pass", places[index][j]);
                            }
                            addMarker("end", places[index][places[index].length - 1]);
                        }
                    } else {
                        alert ('이미 추가된 장소입니다.');
                    }

                    function addMarker(status, info) {
                        // status 에 따라 아이콘 바꾸기
                        switch (status) {
                            case "start":
                                imgUrl = 'http://tmapapis.sktelecom.com/upload/tmap/marker/pin_r_m_s.png';
                                break;
                            case "pass":
                                imgUrl = 'https://tmapapi.sktelecom.com/upload/tmap/marker/pin_b_m_p.png';
                                break;
                            case "end":
                                imgUrl = 'http://tmapapis.sktelecom.com/upload/tmap/marker/pin_r_m_e.png';
                                break;
                            default:
                        }

                        // 관광지 목록에 추가한 대로 marker 생성
                        marker = new Tmapv2.Marker({
                            position: new Tmapv2.LatLng(info.mapy, info.mapx),
                            icon: imgUrl,
                            iconSize: new Tmapv2.Size(24, 38),
                            map: maps[index],
                            title: info.title
                        })
                        viaMarkers[index].push(marker);
                        return marker;
                    }
                })
            })

            // 다음 버튼
            $("#next-btn").click(function () {
            })


            // 전체 관광지 삭제하기 버튼을 누르면 모든 마커를 삭제
            $("#btn_delete").click(function () {
                deleteMarkers();
                if(resultInfoArr.length > 0){
                    for(var i in resultInfoArr){
                        resultInfoArr[i].setMap(null);
                    }
                    resultInfoArr=[];
                }
            })

            // 최적화 버튼을 누르면 ajax 실행
            $("#btn_optimize").click(function () {
                // 마커가 3곳 이상이 아니면 실행되지 않도록 막음
                if(viaMarkerss.length < 3) {
                    alert('경유지는 1개 이상이어야합니다.');
                    return false;
                } else {
                    var headers = {};
                    headers["appKey"] = appKey;

                    // 시작 장소와 종료 장소
                    var start_Mapx = viaMarkerss[0]._marker_data.options.position._lng;
                    var start_Mapy = viaMarkerss[0]._marker_data.options.position._lat;
                    var end_Mapx = viaMarkerss[viaMarkerss.length-1]._marker_data.options.position._lng;
                    var end_Mapy = viaMarkerss[viaMarkerss.length-1]._marker_data.options.position._lat;

                    // 마커에 찍힌 경유지
                    var viaPoints = [];
                    for(var i = 1; i<viaMarkerss.length-1; i++) {
                        var viaPoint = {};
                        viaPoint.viaPointId = i+"경유지";
                        viaPoint.viaPointName = viaMarkerss[i]._marker_data.options.title;
                        viaPoint.viaX = viaMarkerss[i]._marker_data.options.position._lng.toString();
                        viaPoint.viaY = viaMarkerss[i]._marker_data.options.position._lat.toString();
                        viaPoints.push(viaPoint);

                        console.log(viaPoint);
                    }
                    console.log(viaPoints);


                    $.ajax({
                        type: "POST",
                        headers: headers,
                        url: "https://apis.openapi.sk.com/tmap/routes/routeOptimization20?version=1&format=json",
                        async: false,
                        contentType: "application/json",
                        data: JSON.stringify({
                            "startName": "출발",
                            "startX": start_Mapx.toString(),
                            "startY": start_Mapy.toString(),
                            "startTime": startTime,
                            "endName": "도착",
                            "endX": end_Mapx.toString(),
                            "endY": end_Mapy.toString(),
                            "viaPoints": viaPoints,
                            "reqCoordType" : "WGS84GEO",
                            "resCoordType" : "EPSG3857"
                        }),
                        success:function(response){
                            var resultData = response.properties;
                            var resultFeatures = response.features;

                            // 결과 출력
                            var tDistance = "총 거리 : " + (resultData.totalDistance/1000).toFixed(1) + "km,  ";
                            var tTime = "총 시간 : " + (resultData.totalTime/60).toFixed(0) + "분,  ";
                            var tFare = "총 요금 : " + resultData.totalFare + "원";

                            $("#result").text(tDistance+tTime+tFare);

                            // 기존 라인 초기화
                            if(resultInfoArr.length > 0){
                                for(var i in resultInfoArr){
                                    resultInfoArr[i].setMap(null);
                                }
                                resultInfoArr=[];
                            }

                            for(var i in resultFeatures) {
                                var geometry = resultFeatures[i].geometry;
                                var polyline_;

                                drawInfoArr = [];

                                if(geometry.type == "LineString") {
                                    for(var j in geometry.coordinates){
                                        // 경로들의 결과값(구간)들을 포인트 객체로 변환
                                        var latlng = new Tmapv2.Point(geometry.coordinates[j][0], geometry.coordinates[j][1]);
                                        // 포인트 객체를 받아 좌표값으로 변환
                                        var convertPoint = new Tmapv2.Projection.convertEPSG3857ToWGS84GEO(latlng);
                                        // 포인트객체의 정보로 좌표값 변환 객체로 저장
                                        var convertChange = new Tmapv2.LatLng(convertPoint._lat, convertPoint._lng);

                                        drawInfoArr.push(convertChange);
                                    }

                                    polyline_ = new Tmapv2.Polyline({
                                        path : drawInfoArr,
                                        strokeColor : "#FF0000",
                                        strokeWeight: 6,
                                        map : map
                                    });
                                    resultInfoArr.push(polyline_);

                                    // 경유지 최적화 결과 반경만큼 지도 레벨 조정
                                    // var newData = geoData[0];
                                    // PTbounds = new Tmapv2.LatLngBounds();
                                    // for (var i = 0; i < newData.length; i++) {
                                    //     var mData = newData[i];
                                    //     var type = mData.geometry.type;
                                    //     var pointType = mData.properties.pointType;
                                    // }
                                }
                            }
                        },
                        error:function(request,status,error){
                            console.log("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
                        }
                    });
                }
            })

            function deleteMarkers() {
                for (var i=0; i<viaMarkerss.length; i++) {
                    viaMarkerss[i].setMap(null);
                }
                // 등록된 마커 배열도 초기화
                viaMarkerss = [];
                // 장소 배열도 초기화
                placess = [];
                place = null;
                // 출력된 목록도 초기화
                $("#areabox").empty();
            }

            // 경로 보기 버튼을 누르면 ajax 실행
            $("#btn_route").click(function () {
                // 마커가 3곳 이상이 아니면 실행되지 않도록 막음
                if(viaMarkerss.length < 3) {
                    alert('경유지는 1개 이상이어야합니다.');
                    return false;
                } else {
                    var headers = {};
                    headers["appKey"] = appKey;

                    // 시작 장소와 종료 장소
                    var start_Mapx = viaMarkerss[0]._marker_data.options.position._lng;
                    var start_Mapy = viaMarkerss[0]._marker_data.options.position._lat;
                    var end_Mapx = viaMarkerss[viaMarkerss.length-1]._marker_data.options.position._lng;
                    var end_Mapy = viaMarkerss[viaMarkerss.length-1]._marker_data.options.position._lat;

                    // 마커에 찍힌 경유지
                    var viaPoints = [];
                    for(var i = 1; i<viaMarkerss.length-1; i++) {
                        var viaPoint = {};
                        viaPoint.viaPointId = i+"경유지";
                        viaPoint.viaPointName = viaMarkerss[i]._marker_data.options.title;
                        viaPoint.viaX = viaMarkerss[i]._marker_data.options.position._lng.toString();
                        viaPoint.viaY = viaMarkerss[i]._marker_data.options.position._lat.toString();
                        viaPoints.push(viaPoint);

                        console.log(viaPoint);
                    }
                    console.log(viaPoints);


                    $.ajax({
                        type: "POST",
                        headers: headers,
                        url: "https://apis.openapi.sk.com/tmap/routes/routeSequential30?version=1&format=json",
                        async: false,
                        contentType: "application/json",
                        data: JSON.stringify({
                            "startName": "출발",
                            "startX": start_Mapx.toString(),
                            "startY": start_Mapy.toString(),
                            "startTime": startTime,
                            "endName": "도착",
                            "endX": end_Mapx.toString(),
                            "endY": end_Mapy.toString(),
                            "viaPoints": viaPoints
                        }),
                        success:function(response){
                            var resultData = response.properties;
                            var resultFeatures = response.features;

                            // 결과 출력
                            var tDistance = "총 거리 : " + (resultData.totalDistance/1000).toFixed(1) + "km,  ";
                            var tTime = "총 시간 : " + (resultData.totalTime/60).toFixed(0) + "분,  ";
                            var tFare = "총 요금 : " + resultData.totalFare + "원";

                            $("#result").text(tDistance+tTime+tFare);

                            // 기존 라인 초기화
                            if(resultInfoArr.length > 0){
                                for(var i in resultInfoArr){
                                    resultInfoArr[i].setMap(null);
                                }
                                resultInfoArr=[];
                            }

                            for(var i in resultFeatures) {
                                var geometry = resultFeatures[i].geometry;
                                var polyline_;

                                drawInfoArr = [];

                                if(geometry.type == "LineString") {
                                    for(var j in geometry.coordinates){
                                        var point = new Tmapv2.LatLng(geometry.coordinates[j][1],geometry.coordinates[j][0]);

                                        drawInfoArr.push(point);
                                    }

                                    polyline_ = new Tmapv2.Polyline({
                                        path : drawInfoArr,
                                        strokeColor : "#FF0000",
                                        strokeWeight: 6,
                                        map : map
                                    });
                                    resultInfoArr.push(polyline_);


                                    // 경유지 최적화 결과 반경만큼 지도 레벨 조정
                                    // var newData = geoData[0];
                                    // PTbounds = new Tmapv2.LatLngBounds();
                                    // for (var i = 0; i < newData.length; i++) {
                                    //     var mData = newData[i];
                                    //     var type = mData.geometry.type;
                                    //     var pointType = mData.properties.pointType;
                                    // }
                                }
                            }
                        },
                        error:function(request,status,error){
                            console.log("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
                        }
                    });
                }
            })
    }


    function initTmap(mapId) {
        // 1. 지도 띄우기
        map = new Tmapv2.Map(mapId, {
            center: new Tmapv2.LatLng(36.4109466, 128.1590828),
            width: "100%",
            height: "100%",
            zoom: 8,
            zoomControl: true,
            scrollwheel: true
        });

        // 생성된 지도 인스턴스를 저장
        maps.push(map);


    }



    document.addEventListener("DOMContentLoaded", function () {
        // 각 탭 요소들을 선택
        var tabs = document.querySelectorAll('.nav-link');

        // 각 탭에 대해 클릭 이벤트 리스너 추가
        tabs.forEach(function (tab) {
            tab.addEventListener('click', function (event) {
                event.preventDefault(); // 기본 동작 방지

                // 현재 선택한 탭의 일련 번호를 가져옴
                var dayNumber = tab.innerText.split(' ')[1]; // 탭 텍스트에서 'Day'를 제외하고 숫자만 추출
                var dayId = 'day' + dayNumber; // 해당 날짜의 창 ID 생성
                index = Number(dayNumber) - 1;

                // 모든 날짜 창을 숨김
                var allDayWindows = document.querySelectorAll('.day');
                allDayWindows.forEach(function (window) {
                    window.style.display = 'none';
                    window.classList.remove('d-flex');
                });

                // 선택한 날짜 창을 보여줌
                var selectedDayWindow = document.getElementById(dayId);
                selectedDayWindow.style.display = 'block';
                selectedDayWindow.classList.add('d-flex');


                // 해당 탭에 지도가 이미 로드되었는지 확인
                let mapExists = selectedDayWindow.querySelector('canvas');
                // 만약 해당 탭에 지도가 없다면, 지도를 생성하고 표시
                if (!mapExists) {
                    var mapContainer = 'map_div' + dayNumber
                    initTmap2(mapContainer);
                }
            });
        });
    });

    // 이전에 쓴 코드
    // function initTmap(){
    //     // 1. 지도 띄우기
    //     map = new Tmapv2.Map("map_div", {
    //         center: new Tmapv2.LatLng(37.56701114710962, 126.9973611831669),
    //         width : "100%",
    //         height : "100%",
    //         zoom : 15,
    //         zoomControl : true,
    //         scrollwheel : true
    //     });
    //
    //     // 시작, 도착 심볼찍기
    //     // 시작
    //     marker_s = new Tmapv2.Marker({
    //         position : new Tmapv2.LatLng(37.568085523663385, 126.98605733268329),
    //         icon : "https://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_s.png",
    //         iconSize : new Tmapv2.Size(24, 38),
    //         map:map
    //     });
    //
    //     // 도착
    //     marker_e = new Tmapv2.Marker({
    //         position : new Tmapv2.LatLng(37.56445848334345, 127.00973587385866),
    //         icon : "https://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_e.png",
    //         iconSize : new Tmapv2.Size(24, 38),
    //         map:map
    //     });
    //
    //     marker = new Tmapv2.Marker({
    //         position : new Tmapv2.LatLng(37.56626352138058, 126.98735015742581),
    //         icon : "https://tmapapi.sktelecom.com/upload/tmap/marker/pin_b_m_1.png",
    //         iconSize : new Tmapv2.Size(24, 38),
    //         map:map
    //     });
    //
    //     marker = new Tmapv2.Marker({
    //         position : new Tmapv2.LatLng(37.56568310756034, 127.00221495976581),
    //         icon : "https://tmapapi.sktelecom.com/upload/tmap/marker/pin_b_m_2.png",
    //         iconSize : new Tmapv2.Size(24, 38),
    //         map:map
    //     });
    //
    //     marker = new Tmapv2.Marker({
    //         position : new Tmapv2.LatLng(37.570369, 126.992153),
    //         icon : "https://tmapapi.sktelecom.com/upload/tmap/marker/pin_b_m_3.png",
    //         iconSize : new Tmapv2.Size(24, 38),
    //         map:map
    //     });
    //
    //     marker = new Tmapv2.Marker({
    //         position : new Tmapv2.LatLng(37.56335290252303, 127.00352387777271),
    //         icon : "https://tmapapi.sktelecom.com/upload/tmap/marker/pin_b_m_4.png",
    //         iconSize : new Tmapv2.Size(24, 38),
    //         map:map
    //     });
    //
    //     marker = new Tmapv2.Marker({
    //         position : new Tmapv2.LatLng(37.570721714117965, 127.00186090818215),
    //         icon : "https://tmapapi.sktelecom.com/upload/tmap/marker/pin_b_m_5.png",
    //         iconSize : new Tmapv2.Size(24, 38),
    //         map:map
    //     });
    //
    //     marker = new Tmapv2.Marker({
    //         position : new Tmapv2.LatLng(37.56515390827723, 126.99066536776698),
    //         icon : "https://tmapapi.sktelecom.com/upload/tmap/marker/pin_b_m_6.png",
    //         iconSize : new Tmapv2.Size(24, 38),
    //         map:map
    //     });
    //
    //     // var marker = new Tmapv2.Marker({
    //     //     position: new Tmapv2.LatLng(mapx, mapy), 이러면될텐데 어떻게 컨텐츠에접근해야될지모르겠음
    //     //     icon:"https://tmapapi.sktelecom.com/upload/tmap/marker/pin_b_m_1.png",
    //     //     iconSize : new Tmapv2.Size(24, 38),
    //     //     map:map
    //     // })
    //
    //
    //     // 최적화 버튼을 누르면 ajax 실행
    //     $("#btn_optimize").click(function () {
    //         var headers = {};
    //         headers["appKey"]="aDVWgep9DE8rL7yokAybK6jrQIiAk9Ln9jI9CTyf";
    //
    //         // 실행되었다면 지도에 표시된 경로를 지우고 다시 실행하기
    //         if(drawInfoArr.length != 0) {
    //             line.setMap(null);
    //         }
    //
    //
    //         $.ajax({
    //             type:"POST",
    //             headers : headers,
    //             url:"https://apis.openapi.sk.com/tmap/routes/routeOptimization20?version=1&format=json",
    //             async:false,
    //             contentType: "application/json",
    //             data: JSON.stringify({
    //                 "reqCoordType": "WGS84GEO",
    //                 "resCoordType" : "EPSG3857",
    //                 "startName": "출발",
    //                 "startX": "126.98605733268329",
    //                 "startY": "37.568085523663385",
    //                 "startTime": "201711121314",
    //                 "endName": "도착",
    //                 "endX": "127.00973587385866",
    //                 "endY": "37.56445848334345",
    //                 "searchOption" : "0",
    //                 "viaPoints": [
    //                     {
    //                         "viaPointId": "test01",
    //                         "viaPointName": "test01",
    //                         "viaX": "126.98735015742581",
    //                         "viaY": "37.56626352138058",
    //                     },
    //                     {
    //                         "viaPointId": "test02",
    //                         "viaPointName": "test02",
    //                         "viaX": "127.00221495976581",
    //                         "viaY": "37.56568310756034",
    //                     },
    //                     {
    //                         "viaPointId": "test03",
    //                         "viaPointName": "test03",
    //                         "viaX": "126.992153",
    //                         "viaY": "37.570369",
    //                     },
    //                     {
    //                         "viaPointId": "test04",
    //                         "viaPointName": "test04",
    //                         "viaX": "127.00352387777271",
    //                         "viaY": "37.56335290252303",
    //                     },
    //                     {
    //                         "viaPointId": "test05",
    //                         "viaPointName": "test05",
    //                         "viaX": "127.00186090818215",
    //                         "viaY": "37.570721714117965",
    //                     },
    //                     {
    //                         "viaPointId": "test06",
    //                         "viaPointName": "test06",
    //                         "viaX": "126.99066536776698",
    //                         "viaY": "37.56515390827723",
    //                     }
    //                 ]
    //             }),
    //             success:function(response){
    //                 var resultData = response.properties;
    //                 var resultFeatures = response.features;
    //
    //                 // 결과 출력
    //                 var tDistance = "총 거리 : " + (resultData.totalDistance/1000).toFixed(1) + "km,  ";
    //                 var tTime = "총 시간 : " + (resultData.totalTime/60).toFixed(0) + "분,  ";
    //                 var tFare = "총 요금 : " + resultData.totalFare + "원";
    //
    //                 $("#result").text(tDistance+tTime+tFare);
    //
    //                 for(var i in resultFeatures) {
    //                     var geometry = resultFeatures[i].geometry;
    //                     var properties = resultFeatures[i].properties;
    //                     var polyline_;
    //
    //                     drawInfoArr = [];
    //
    //                     if(geometry.type == "LineString") {
    //                         for(var j in geometry.coordinates){
    //                             // 경로들의 결과값(구간)들을 포인트 객체로 변환
    //                             var latlng = new Tmapv2.Point(geometry.coordinates[j][0], geometry.coordinates[j][1]);
    //                             // 포인트 객체를 받아 좌표값으로 변환
    //                             var convertPoint = new Tmapv2.Projection.convertEPSG3857ToWGS84GEO(latlng);
    //                             // 포인트객체의 정보로 좌표값 변환 객체로 저장
    //                             var convertChange = new Tmapv2.LatLng(convertPoint._lat, convertPoint._lng);
    //
    //                             drawInfoArr.push(convertChange);
    //                         }
    //
    //                         polyline_ = new Tmapv2.Polyline({
    //                             path : drawInfoArr,
    //                             strokeColor : "#FF0000",
    //                             strokeWeight: 6,
    //                             map : map
    //                         });
    //                     }
    //                 }
    //             },
    //             error:function(request,status,error){
    //                 console.log("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
    //             }
    //         });
    //     })
    // }
    //
    //
    // // 아이콘 누르면 장소 담기에 추가하는 함수
    // $(document).ready(function() {
    //     $('.plus').click(function() {
    //         const areaname = $(this).prev('div').children('div').text();
    //         console.log(areaname);
    //         $("#areabox").append("<a href='#' class='list-group-item list-group-item-action py-3 lh-tight' aria-current='true'> <div class='d-flex w-100 align-items-center justify-content-between'> <strong class='mb-1'>" + areaname + "</strong> <button class='delete' type='button' onclick='deleteRow(this);'><i class='bi bi-x-circle'></i></button> </div> </a>")
    //     })
    // })


</script>

<!--계획 화면에선 헤더가 안들어가야됨-->
<!--이전 화면에서 input 값으로 여행 start day와 여행 end day 값을 가지고 옵니다. (start day가 더 작은지에 대한 유효성 검사가 필요합니다.)-->
<!--유효한 날짜값을 받았다면 end day - start day + 1 을 해서 일자 수를 계산합니다.-->
<!--계산한 일자수를 토대로 day1, day2... 등을 출력합니다.-->
<!--day1을 클릭하면 그 날짜의 장소를 검색하고 선택해서 가져오면, 빈칸에는 장소에 해당하는 지도가 출력됩니다.-->
<style>
    *::-webkit-scrollbar {
        width: 5px !important;
    }
    *::-webkit-scrollbar-thumb {
        height: 30%; /* 스크롤바의 길이 */
        background: #ddd; /* 스크롤바의 색상 */
        border-radius: 10px;
    }
    *::-webkit-scrollbar-track {
        background: #fff;  /*스크롤바 뒷 배경 색상*/
    }

    .container-fluid {
        overflow-y: hidden !important;
    }
    body {
        scrollbar-width: none;
    }
    ul {
        padding-left: 0 !important;
        margin-bottom: 0 !important;
    }
    .row {
        justify-content: space-between;
    }
    .row > * {
        padding-right: 0 !important;
        padding-left: 0 !important;
    }
    .search-scroll {
        overflow-y: auto;
        overflow-x: hidden;
        height: calc(100vh - 112px);
    }
    .scroll {
        overflow-y: auto;
        overflow-x: hidden;
        height: calc(100vh - 79px);
        height: calc(100vh - 114px);
    }
    .default {
        width: calc(100% - 760px);
        /* 기본 너비 상태 */
    }
    .plus, .delete {
        background: #fff;
        border: 0px;
        width: 30px;
        height: 30px;
        border-radius: 100%;
    }
    .list-group-item {
        border-width: 0 0 1px 0 !important;
    }

    #toggle-btn {
        border: 0 !important;
        position: absolute;
        width: 30px;
        height: 30px;
        top: 50vh;
        left: 0px;
        z-index: 9999;
        border-radius: 0 5px 5px 0;
    }

    .d-flex:has(#toggle-btn) {
        position: relative;
    }

    #areabox{
        position:relative;
    }
    .wide {
        width: calc(100% - 380px) !important;
    }
    .search-bar {
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 10px;
        margin: 8px;
        align-items: center;
        justify-content: center;
    }
    .search-bar__input {
        width: 313px;
        border: none;
        outline: none;
    }
    .search-btn {
        width: 20px;
        height: 20px;
        background: none;
        border: none;
    }
    #your_item {
        position: relative;
        overflow-y: auto;
        overflow-x: hidden;
        height: 100vh;
        max-height: 100vh;
    }
    .overflow-y-auto {
        overflow-y: auto;
    }

    .overflow-x-hidden {
        overflow-x: hidden;
    }

    .map-result {
        z-index: 9998;
    }
    img.thumbnail {
        width: 60px;
        height: 60px;
        object-fit: cover;
    }
    .content-title {
        font-weight: bold;
        width: 255px;
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 1;
        -webkit-box-orient: vertical;
        line-height: 1.5;
        height: 1.5rem;
    }
    .content-address {
        font-size: 0.8rem;
        width: 255px;
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 1;
        -webkit-box-orient: vertical;
        line-height: 1.5;
        height: 1.5rem;
    }
    .day {
        width: calc(100% - 7rem);
    }
</style>


<div class="container-fluid">
    <!--한줄로 정렬합니다.-->
    <div class="row">
        <!--여행 몇일차인지-->
        <div class="vh-100 d-flex flex-column bg-light" style="width: 7rem;">
            <a href="/" class="d-block p-3 link-dark text-decoration-none text-center" title="" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-original-title="Icon-only">
                일정
            </a>
            <ul class="nav nav-pills nav-flush flex-column mb-auto text-center">
<!--                <li class="nav-item" role="presentation">-->
<!--                    <a href="#" class="nav-link active py-3 border-bottom" aria-current="page" title="" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-original-title="Home">-->
<!--                        Day 1-->
<!--                    </a>-->
<!--                </li>-->
                <!-- 반복하여 탭 생성 -->
                <th:block th:each="dayNumber : ${dayNumbers}">
                    <li class="nav-item" role="presentation">
                        <a href="#" class="nav-link py-3 border-bottom" aria-current="page"  title="" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-original-title="Day" th:text="${'Day ' + dayNumber}">
                        </a>
                    </li>
                </th:block>
<!--                <li role="presentation">-->
<!--                    <a href="#" class="nav-link py-3 border-bottom" title="" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-original-title="Dashboard">-->
<!--                        Day 2-->
<!--                    </a>-->
<!--                </li>-->
<!--                <li role="presentation">-->
<!--                    <a href="#" class="nav-link py-3 border-bottom" title="" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-original-title="Orders">-->
<!--                        Day 3-->
<!--                    </a>-->
<!--                </li>-->
<!--                <li role="presentation">-->
<!--                    <a href="#" class="nav-link py-3 border-bottom" title="" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-original-title="Products">-->
<!--                        Day 4-->
<!--                    </a>-->
<!--                </li>-->
<!--                <li role="presentation">-->
<!--                    <a href="#" class="nav-link py-3 border-bottom" title="" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-original-title="Customers">-->
<!--                        Day 5-->
<!--                    </a>-->
<!--                </li>-->
            </ul>
            <div class="btn_con text-center">
                <button type="button" id="next-btn" class="btn btn-primary" >다음</button>
            </div>
            <div class="dropdown border-top">
                <a href="#" class="d-flex align-items-center justify-content-center p-3 link-dark text-decoration-none dropdown-toggle" id="dropdownUser3" data-bs-toggle="dropdown" aria-expanded="false">
                    <img src="https://github.com/mdo.png" alt="mdo" width="24" height="24" class="rounded-circle">
                </a>
                <ul class="dropdown-menu text-small shadow" aria-labelledby="dropdownUser3">
                    <li><a class="dropdown-item" href="#">New project...</a></li>
                    <li><a class="dropdown-item" href="#">Settings</a></li>
                    <li><a class="dropdown-item" href="#">Profile</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="#">Sign out</a></li>
                </ul>
            </div>
        </div>

        <th:block th:each="dayNumber : ${dayNumbers}">
        <div th:id="'day' + ${dayNumber}" class="day row vh-100 d-flex flex-column">
            <!--장소찾기-->
            <div id="select_item" class="vh-100 d-flex flex-column align-items-stretch bg-white" style="width: 380px;">
                <a href="/" class="d-flex align-items-center flex-shrink-0 p-3 link-dark text-decoration-none">
                    <span class="fs-5 fw-semibold">도시명</span>
                    <span class="fx-6">이전화면에서 선택한 날짜</span>
                </a>
                <div class="search-bar">
                    <input class="search-bar__input" placeholder="장소를 검색하세요.">
                    <button class="search-btn" type="submit"><i class="bi bi-search"></i></button>
                </div>

                <div class="search-scroll list-group list-group-flush border-bottom scrollarea">
                    <div class="flex overflow-x-hidden">
                        <!--장소 불러오기-->
                        <div id="touritems">
                            <div>
                                <h4 th:text="|${pageResponse.total}건의 관광지|"></h4>
                            </div>

                            <th:block th:if="${pageResponse.total > 0}" th:each="touritem : ${pageResponse.dtoList}">

                                <!--선택된 객체에는 active 클래스를 주면 파란 배경이 됨-->
                                <a class="list-group-item list-group-item-action py-3 lh-tight" aria-current="true">
                                    <div class="d-flex w-100 align-items-center justify-content-between">
                                        <!-- 이미지 출력하기 -->
                                        <div style="width: 60px; height: 60px;">
                                            <img class="thumbnail" th:if="${touritem.firstimage == null || touritem.firstimage.isEmpty()}" src="../../../assets/img/no_img.jpg">
                                            <img class="thumbnail" th:unless="${touritem.firstimage == null || touritem.firstimage.isEmpty()}" th:src="${touritem.firstimage}">
                                        </div>

                                        <div th:title="${touritem.title}" class="ps-3">
                                            <input type="hidden" th:id="mapx" th:value="${touritem.mapx}">
                                            <input type="hidden" th:id="mapy" th:value="${touritem.mapy}">
                                            <div class="content-title" th:href="@{/info/content/{contentid}(contentid=${touritem.contentid})}" th:text="${touritem.title}"></div>
                                            <p class="content-address" th:text="${touritem.address}"></p>
                                        </div>

                                        <button class="plus">
                                            <!--아이콘 눌러서 담기-->
                                            <i class="bi bi-bookmark-plus"></i>
                                        </button>
                                    </div>
                                    <div class="col-10 mb-1 small" >
                                        <label th:text="${touritem.fullCategoryName}"></label>
                                    </div>
                                </a>
                            </th:block>


                            <th:block th:unless="${pageResponse.total > 0}">
                                <p class="mb-1 touritem-no-contents">
                                    검색된 관광지 정보가 없습니다.
                                </p>
                            </th:block>

                            <nav aria-label="page-bar">
                                <ul class="pagination">
                                    <li class="page-item">
                                    <span class="page-link" data-num="0">
                                        <i class="bi bi-chevron-double-left"></i>
                                    </span>
                                    </li>
                                    <li class="page-item" th:classappend="${pageResponse.prev} ? '' : 'disabled'">
                                    <span class="page-link" th:attr="data-num=${pageResponse.start -1}">
                                        <i class="bi bi-chevron-left"></i>
                                    </span>
                                    </li>
                                    <th:block th:each="pageNo : ${#numbers.sequence(pageResponse.start, pageResponse.end)}">
                                        <li class="page-item"><span class="page-link" th:attr="data-num=${pageNo}" th:classappend="${pageResponse.page == pageNo} ? 'active' : ''" th:text="${pageNo + 1}"></span></li>
                                    </th:block>
                                    <li class="page-item" th:classappend="${pageResponse.next} ? '' : 'disabled'">
                                    <span class="page-link" th:attr="data-num=${pageResponse.end +1}">
                                        <i class="bi bi-chevron-right"></i>
                                    </span>
                                    </li>
                                    <li class="page-item">
                                    <span class="page-link" th:attr="data-num=${pageResponse.last}">
                                        <i class="bi bi-chevron-double-right"></i>
                                    </span>
                                    </li>
                                </ul>
                            </nav>
                        </div>


                        <!--선택되면 이렇게 파란배경으로 하고 싶었음-->
                        <!--                    <a href="#" class="list-group-item list-group-item-action active py-3 lh-tight" aria-current="true">-->
                        <!--                        <div class="d-flex w-100 align-items-center justify-content-between">-->
                        <!--                            <strong class="mb-1">장소1</strong>-->
                        <!--                            <button class="plus">-->
                        <!--                                &lt;!&ndash;아이콘 눌러서 담기&ndash;&gt;-->
                        <!--                                <i class="bi bi-bookmark-plus"></i>-->
                        <!--                            </button>-->
                        <!--                        </div>-->
                        <!--                        <div class="col-10 mb-1 small">Some placeholder content in a paragraph below the heading and date.</div>-->
                        <!--                    </a>-->


                        <!--                    <a href="#" class="list-group-item list-group-item-action py-3 lh-tight">-->
                        <!--                        <div class="d-flex w-100 align-items-center justify-content-between">-->
                        <!--                            <strong class="mb-1">장소2</strong>-->
                        <!--                            <button class="plus">-->
                        <!--                                <i class="bi bi-bookmark-plus"></i>-->
                        <!--                            </button>-->
                        <!--                        </div>-->
                        <!--                        <div class="col-10 mb-1 small">Some placeholder content in a paragraph below the heading and date.</div>-->
                        <!--                    </a>-->
                        <!--                    <a href="#" class="list-group-item list-group-item-action py-3 lh-tight">-->
                        <!--                        <div class="d-flex w-100 align-items-center justify-content-between">-->
                        <!--                            <strong class="mb-1">장소3</strong>-->
                        <!--                            <button class="plus">-->
                        <!--                                <i class="bi bi-bookmark-plus"></i>-->
                        <!--                            </button>-->
                        <!--                        </div>-->
                        <!--                        <div class="col-10 mb-1 small">Some placeholder content in a paragraph below the heading and date.</div>-->
                        <!--                    </a>-->

                        <!--                    <a href="#" class="list-group-item list-group-item-action py-3 lh-tight" aria-current="true">-->
                        <!--                        <div class="d-flex w-100 align-items-center justify-content-between">-->
                        <!--                            <strong class="mb-1">장소4</strong>-->
                        <!--                            <button class="plus">-->
                        <!--                                <i class="bi bi-bookmark-plus"></i>-->
                        <!--                            </button>-->
                        <!--                        </div>-->
                        <!--                        <div class="col-10 mb-1 small">Some placeholder content in a paragraph below the heading and date.</div>-->
                        <!--                    </a>-->
                        <!--                    <a href="#" class="list-group-item list-group-item-action py-3 lh-tight">-->
                        <!--                        <div class="d-flex w-100 align-items-center justify-content-between">-->
                        <!--                            <strong class="mb-1">장소5</strong>-->
                        <!--                            <button class="plus">-->
                        <!--                                <i class="bi bi-bookmark-plus"></i>-->
                        <!--                            </button>-->
                        <!--                        </div>-->
                        <!--                        <div class="col-10 mb-1 small">Some placeholder content in a paragraph below the heading and date.</div>-->
                        <!--                    </a>-->
                        <!--                    <a href="#" class="list-group-item list-group-item-action py-3 lh-tight">-->
                        <!--                        <div class="d-flex w-100 align-items-center justify-content-between">-->
                        <!--                            <strong class="mb-1">장소6</strong>-->
                        <!--                            <button class="plus">-->
                        <!--                                <i class="bi bi-bookmark-plus"></i>-->
                        <!--                            </button>-->
                        <!--                        </div>-->
                        <!--                        <div class="col-10 mb-1 small">Some placeholder content in a paragraph below the heading and date.</div>-->
                        <!--                    </a>-->
                        <!--                    <a href="#" class="list-group-item list-group-item-action py-3 lh-tight" aria-current="true">-->
                        <!--                        <div class="d-flex w-100 align-items-center justify-content-between">-->
                        <!--                            <strong class="mb-1">장소7</strong>-->
                        <!--                            <button class="plus">-->
                        <!--                                <i class="bi bi-bookmark-plus"></i>-->
                        <!--                            </button>-->
                        <!--                        </div>-->
                        <!--                        <div class="col-10 mb-1 small">Some placeholder content in a paragraph below the heading and date.</div>-->
                        <!--                    </a>-->
                        <!--                    <a href="#" class="list-group-item list-group-item-action py-3 lh-tight">-->
                        <!--                        <div class="d-flex w-100 align-items-center justify-content-between">-->
                        <!--                            <strong class="mb-1">장소8</strong>-->
                        <!--                            <button class="plus">-->
                        <!--                                <i class="bi bi-bookmark-plus"></i>-->
                        <!--                            </button>-->
                        <!--                        </div>-->
                        <!--                        <div class="col-10 mb-1 small">Some placeholder content in a paragraph below the heading and date.</div>-->
                        <!--                    </a>-->
                        <!--                    <a href="#" class="list-group-item list-group-item-action py-3 lh-tight">-->
                        <!--                        <div class="d-flex w-100 align-items-center justify-content-between">-->
                        <!--                            <strong class="mb-1">장소9</strong>-->
                        <!--                            <button class="plus">-->
                        <!--                                <i class="bi bi-bookmark-plus"></i>-->
                        <!--                            </button>-->
                        <!--                        </div>-->
                        <!--                        <div class="col-10 mb-1 small">Some placeholder content in a paragraph below the heading and date.</div>-->
                        <!--                    </a>-->
                        <!--                    <a href="#" class="list-group-item list-group-item-action py-3 lh-tight" aria-current="true">-->
                        <!--                        <div class="d-flex w-100 align-items-center justify-content-between">-->
                        <!--                            <strong class="mb-1">장소10</strong>-->
                        <!--                            <button class="plus">-->
                        <!--                                <i class="bi bi-bookmark-plus"></i>-->
                        <!--                            </button>-->
                        <!--                        </div>-->
                        <!--                        <div class="col-10 mb-1 small">Some placeholder content in a paragraph below the heading and date.</div>-->
                        <!--                    </a>-->
                        <!--                    <a href="#" class="list-group-item list-group-item-action py-3 lh-tight">-->
                        <!--                        <div class="d-flex w-100 align-items-center justify-content-between">-->
                        <!--                            <strong class="mb-1">장소11</strong>-->
                        <!--                            <button class="plus">-->
                        <!--                                <i class="bi bi-bookmark-plus"></i>-->
                        <!--                            </button>-->
                        <!--                        </div>-->
                        <!--                        <div class="col-10 mb-1 small">Some placeholder content in a paragraph below the heading and date.</div>-->
                        <!--                    </a>-->
                        <!--                    <a href="#" class="list-group-item list-group-item-action py-3 lh-tight">-->
                        <!--                        <div class="d-flex w-100 align-items-center justify-content-between">-->
                        <!--                            <strong class="mb-1">장소12</strong>-->
                        <!--                            <button class="plus">-->
                        <!--                                <i class="bi bi-bookmark-plus"></i>-->
                        <!--                            </button>-->
                        <!--                        </div>-->
                        <!--                        <div class="col-10 mb-1 small">Some placeholder content in a paragraph below the heading and date.</div>-->
                        <!--                    </a>-->
                    </div>
                </div>
            </div>


            <!--장소담기-->
            <div id="your_item" class="vh-100 d-flex flex-column align-items-stretch bg-white" style="width: 380px;">
                <a href="/" class="d-flex align-items-center flex-shrink-0 p-3 link-dark text-decoration-none border-bottom">
                    <span class="fs-5 fw-semibold" th:text="DAY + ${dayNumber}"></span>
                </a>

                <!--버튼눌러서 담으면 이렇게 됩니다.-->
                <!--            <div id="areabox" class="scroll list-group list-group-flush border-bottom scrollarea">-->
                <!--                <a href="#" class="list-group-item list-group-item-action active py-3 lh-tight" aria-current="true">-->
                <!--                    <div class="d-flex w-100 align-items-center justify-content-between">-->
                <!--                        <strong class="mb-1">장소1</strong>-->
                <!--                        <small>-->
                <!--아이콘 눌러서 담기-->
                <!--                            <button id="deleteBtn" type="button" onclick="deleteRow(this);">-->
                <!--                                <i class='bi bi-x-circle'></i>-->
                <!--                            </button>-->
                <!--                        </small>-->
                <!--                    </div>-->
                <!--                </a>-->
                <!--            </div>-->

                <div id="areabox" class="scroll list-group list-group-flush scrollarea">
                </div>
            </div>

            <!--지도가 들어갑니다.-->
            <div id="map" class="vh-100 d-flex flex-column align-items-stretch default">
                <button id="toggle-btn" class="bg-white text-center" type="button" onclick="toggleDay();">
                    <i id="toggle-btn-icon" class="bi bi-caret-left-fill"></i>
                </button>

                <div class="map-result position-absolute">
                    <p id="result"></p>
                    <button id="btn_route" class="btn btn-primary">경로 확인</button>
                    <button id="btn_optimize" class="btn btn-primary">동선 추천</button>
                    <button id="btn_delete" class="btn btn-danger">전체 삭제</button>
                </div>
                <div th:id="map_div + ${dayNumber}">
                </div>
            </div>
        </div>
        </th:block>

    </div>
</div>
</body>
</html>